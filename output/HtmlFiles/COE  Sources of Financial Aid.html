<!doctype html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COE - Sources of Financial Aid</title>
  <link rel="stylesheet" href="/programs/coe/lib/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/programs/coe/css/aris.css?v=LIo_E_MlRbpAgVETlGDmI7iO8GLX5WP8VuAujQDtr2U">
  <link rel="stylesheet" href="/programs/coe/css/charting.css?v=_PhiRJSqoPbAoWb5Ab3Lt5ZQLC4KOYj648_9PNvNXuI">
  <link rel="stylesheet" type="text/css" href="/programs/coe/css/d3map.css">
  <script src="/programs/coe/js/d3.v7.min.js"></script>
  <script src="/programs/coe/lib/jquery/dist/jquery.js"></script>
  <script src="/programs/coe/js/charting.js?t=07-26-2023-11-09"></script>
  <script src="/programs/coe/js/chart-helpers.js?t=07-26-2023-11-09"></script>
  <meta name="keywords" content="Certificate, Constant dollars, Control of institutions, Degree-granting institutions, Financial aid, Full-time enrollment, Postsecondary institutions (basic classification by level), Private institution, Public school or institution, Undergraduate students">
  <script src="/programs/coe/js/clipboard.min.js"></script>
 </head>
 <body>
  <!-- HEADER STARTS HERE-->
  <div class="headContents">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/IESfavicon_32px.png">
   <link rel="icon" type="image/png" sizes="128x128" href="/images/favicons/IESfavicon_128px.png">
   <link rel="icon" type="image/png" sizes="152x152" href="/images/favicons/IESfavicon_152px.png">
   <link rel="icon" type="image/png" sizes="167x167" href="/images/favicons/IESfavicon_167px.png">
   <link rel="icon" type="image/png" sizes="180x180" href="/images/favicons/IESfavicon_180px.png">
   <link rel="icon" type="image/png" sizes="192x192" href="/images/favicons/IESfavicon_192px.png">
   <link rel="icon" type="image/png" sizes="196x196" href="/images/favicons/IESfavicon_196px.png">
   <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
   <link href="/css/main.css" rel="stylesheet" type="text/css">
   <link href="/css/IES_Core_0004.css" rel="stylesheet" type="text/css">
   <link href="/css/IES_Mobile_0004.css" rel="stylesheet" type="text/css">
  </div><!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-0EYJGC1REQ"></script>
  <script>
	window.dataLayer = window.dataLayer || [];
	function gtag() { dataLayer.push(arguments); }
	gtag('js', new Date());

	gtag('config', 'G-0EYJGC1REQ');
</script>
  <script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
  <script type="text/javascript">
	//<![CDATA[
	var $$i = jQuery.noConflict(true);
	//]]>
</script>
  <script type="text/javascript" src="/js/hfsNav.js?v=02"></script>
  <script type="text/javascript" src="/js/nav_0005.js"></script>
  <script type="text/javascript" src="/js/importBlogPosts.js"></script>
  <script type="text/javascript" src="/js/main.js"></script>
  <div class="nces">
   <a name="top"></a>
   <div style="display:none">
    <a href="#content" title="Skip Navigation">Skip Navigation</a>
   </div>
   <div class="header_container">
    <div class="header">
     <div class="clearfix header_nav">
      <div class="bc">
       <a href="//ies.ed.gov">IES</a> <span class="carrot">&nbsp;<img src="/images/icons/iesNewDots.png" alt=" ">&nbsp;</span> <a href="/" class="top_nav">
        <div class="l ctr">
         NCES
        </div><span class="long_name">National Center for<br>
          Education Statistics</span>
        <div class="l menuIcon">
         <img src="/images/icons/menuIcon.png" alt="Menu">
        </div></a>
      </div>
      <div class="clearfix main_nav">
       <div class="clearfix ies_cnav nces_nav_c">
        <ul class="sub_cats">
         <li class="sub_c_nav"><a href="/surveys">Surveys &amp; Programs</a>
          <ul>
           <li><a href="/annuals/">Annual Reports</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/programs/coe/" title="Condition of Education">Condition of Education</a> <a href="/programs/digest/" title="Digest of Education Statistics">Digest of Education Statistics</a> <a href="/programs/pes/" title="Projections of Education Statistics">Projections of Education Statistics</a> <a href="/surveys/annualreports/topical-studies/summary/">Topical Studies</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=4">National Assessments</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/nationsreportcard" title="National Assessment of Educational Progress (NAEP)">National Assessment of Educational Progress (NAEP)</a> <a href="/surveys/piaac/current_results.asp" title="Program for the International Assessment of Adult Competencies (PIAAC)">Program for the International Assessment of Adult Competencies (PIAAC)</a></li>
            </ul></li>
           <li><a href="/surveys/international/" title="International">International Assessments</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/surveys/international/" title="International Activities Program (IAP)">International Activities Program (IAP)</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=3">Early Childhood</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/ecls/" title="Early Childhood Longitudinal Study (ECLS)">Early Childhood Longitudinal Study (ECLS)</a> <a href="/nhes/" title="National Household Education Survey (NHES)">National Household Education Survey (NHES)</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=1">Elementary/ Secondary</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/ccd/" title="Common Core of Data (CCD)">Common Core of Data (CCD)</a> <a href="/surveys/slsp/" title="Secondary Longitudinal Studies Program">Secondary Longitudinal Studies Program</a> <a href="/programs/edge/" title="Education Demographic and Geographic Estimates (EDGE)">Education Demographic and Geographic Estimates (EDGE)</a> <a href="/surveys/ntps/" title="National Teacher and Principal Survey (NTPS)">National Teacher and Principal Survey (NTPS)</a> <a href="/surveys/SurveyGroups.asp?group=1" title="more Elementary/Secondary">more...</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=5" title="Library">Library</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/surveys/libraries/" title="Library Statistics Program">Library Statistics Program</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=2" title="Postsecondary">Postsecondary</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/surveys/b&amp;b/" title="Baccalaureate and Beyond (B&amp;B)">Baccalaureate and Beyond (B&amp;B)</a> <a href="/surveys/ctes/" title="Career/Technical Education Statistics (CTES)">Career/Technical Education Statistics (CTES)</a> <a href="/ipeds/" title="Integrated Postsecondary Education Data System (IPEDS)">Integrated Postsecondary Education Data System (IPEDS)</a> <a href="/surveys/npsas/" title="National Postsecondary Student Aid Study (NPSAS)">National Postsecondary Student Aid Study (NPSAS)</a> <a href="/surveys/SurveyGroups.asp?group=2" title="more Postsecondary">more...</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=8" title="Data Systems, Use, &amp; Privacy">Data Systems, Use, &amp; Privacy</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/programs/ceds/" title="Common Education Data Standards (CEDS)">Common Education Data Standards (CEDS)</a> <a href="/forum/" title="National Forum on Education Statistics">National Forum on Education Statistics</a> <a href="/programs/SLDS/" title="Statewide Longitudinal Data Systems Grant Program - (SLDS)">Statewide Longitudinal Data Systems Grant Program - (SLDS)</a> <a href="/surveys/SurveyGroups.asp?group=8" title="more Data Systems, Use, &amp; Privacy">more...</a></li>
            </ul></li>
           <li><a href="/surveys/SurveyGroups.asp?group=7" title="Resources">Resources</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/training/datauser/" title="Distance Learning Dataset Training">Distance Learning Dataset Training</a> <a href="/npec/" title="National Postsecondary Education Cooperative (NPEC)">National Postsecondary Education Cooperative (NPEC)</a> <a href="/statprog/" title="Statistical Standards Program">Statistical Standards Program</a> <a href="/surveys/SurveyGroups.asp?group=7" title="more Resources">more...</a></li>
            </ul></li>
          </ul></li>
         <li class="sub_c_nav"><a href="/datatools">Data &amp; Tools</a>
          <ul>
           <!--<li><a href="#">Subject</a>
										<ul class="clearfix">
											<li class="left_col">
												<a href="#">Assessments</a>
												<a href="#">K-12 Students</a>
												<a href="#">K-12 Teachers and Faculty</a>
												<a href="#">K-12 Schools</a>
												<a href="#">College Students</a>
												<a href="#">College Faculty</a>
												<a href="#">College Institutions</a>
												<a href="#">Mapping</a>
											</li>
										</ul>
									</li>-->
           <li><a href="/datatools/index.asp?DataToolSectionID=1">Downloads Microdata/Raw Data</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/ipeds/deltacostproject/" title="Delta Cost Project">Delta Cost Project</a> <a href="/ipeds/datacenter/" title="IPEDS Data Center">IPEDS Data Center</a> <a href="/pubsearch/licenses.asp" title="How to apply for Restricted Use License">How to apply for Restricted Use License</a> <a href="/datalab/onlinecodebook/" title="Online Codebook">Online Codebook</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=2">Online Analysis</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/programs/edge/Demographic/ACS" title="ACS-ED Tables">ACS-ED Tables</a> <a href="/datalab/" title="Data Lab">Data Lab</a> <a href="/ccd/elsi/" title="Elementary Secondary Information System">Elementary Secondary Information System</a> <a href="/surveys/international/ide/" title="International Data Explorer">International Data Explorer</a> <a href="/ipeds/datacenter/" title="IPEDS Data Center">IPEDS Data Center</a> <a href="/nationsreportcard/naepdata/" title="NAEP Data Explorer">NAEP Data Explorer</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=3">School and College Search</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/programs/edge/acsdashboard" title="ACS Dashboard">ACS Dashboard</a> <a href="/collegenavigator/" title="College Navigator">College Navigator</a> <a href="/surveys/pss/privateschoolsearch/" title="Private Schools">Private Schools</a> <a href="/ccd/districtsearch/" title="Public School Districts">Public School Districts</a> <a href="/ccd/schoolsearch/" title="CCD School Search">Public Schools</a> <a href="/globallocator/" title="Search for Schools and Colleges">Search for Schools and Colleges</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=4">Comparison Tools</a>
            <ul class="clearfix">
             <li class="left_col"><a href="https://www.nationsreportcard.gov/profiles/stateprofile/" title="NAEP State Profiles">NAEP State Profiles (nationsreportcard.gov)</a> <a href="/edfin/search/search_intro.asp" title="Public School District Finance Peer Search">Public School District Finance Peer Search</a> <a href="/edfin/index.asp" title="Education Finance Statistics Center">Education Finance Statistics Center</a> <a href="/ipeds/datacenter/" title="IPEDS Data Center">IPEDS Data Center</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=5">Questionnaire Tools</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/nationsreportcard/itmrlsx/" title="NAEP Question Tool">NAEP Question Tool</a> <a href="/NAAL/sample_items.asp" title="NAAL Questions Tool">NAAL Questions Tool</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=6">Geographic Tools</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/programs/edge/acsdashboard" title="ACS-ED Dashboard">ACS-ED Dashboard</a> <a href="/programs/maped/ACSMaps" title="ACS-ED Maps">ACS-ED Maps</a> <a href="/programs/maped/LocaleLookup" title="Locale Lookup">Locale Lookup</a> <a href="/programs/maped" title="MapEd">MapEd</a> <a href="/programs/mapED/SafeMap" title="SAFEMap">SAFEMap</a> <a href="/ccd/schoolmap" title="School and District Navigator">School and District Navigator</a></li>
            </ul></li>
           <li><a href="/datatools/index.asp?DataToolSectionID=7">Other Tools</a>
            <ul class="clearfix">
             <li class="left_col"><a href="/bibliography/" title="Bibliography">Bibliography</a> <a href="//datainventory.ed.gov" title="Bibliography">ED Data Inventory</a></li>
            </ul></li>
          </ul></li>
         <li><a href="/fastfacts/" class="nces_facts">Fast Facts</a>
          <ul class="clearfix">
           <li class="left_col"><a href="/fastfacts/index.asp?faq=FFOption1#faqFFOption1" title="Assessments">Assessments</a> <a href="/fastfacts/index.asp?faq=FFOption2#faqFFOption2" title="Early Childhood">Early Childhood</a> <a href="/fastfacts/index.asp?faq=FFOption3#faqFFOption3" title="Elementary and Secondary">Elementary and Secondary</a> <a href="/fastfacts/index.asp?faq=FFOption4#faqFFOption4" title="Postsecondary and Beyond">Postsecondary and Beyond</a> <a href="/fastfacts/index.asp?faq=FFOption5#faqFFOption5" title="Resources">Resources</a> <a href="/fastfacts/index.asp?faq=FFOption6#faqFFOption6" title="Special Topics">Special Topics</a></li>
          </ul></li><!--<li><a href="#" class="nces_sch_search">School Search</a>
								<ul class="clearfix">
									<li class="left_col">
										<a href="/globallocator/" title="Search for Schools and Colleges">Search for Schools and Colleges</a>
										<a href="/collegenavigator/" title="College Navigator">College Navigator</a>

										<a href="/datatools" title="Other Search Tools">Other Search Tools</a>
										<a href="/ccd/schoolsearch/" title="Public Schools">Public Schools</a>
										<a href="/ccd/districtsearch/" title="Public School Districts">Public School Districts</a>
										<a href="/surveys/pss/privateschoolsearch/" title="Private Schools">Private Schools</a>
									</li>
								</ul>
							</li>-->
         <li><a href="/whatsnew/" class="nces_news">News &amp; Events</a>
          <ul class="clearfix">
           <li class="left_col"><a href="/blogs/nces/" title="NCES Blog">NCES Blog</a> <a href="/whatsnew/" title="What's New at NCES">What's New at NCES</a> <a href="//ies.ed.gov/whatsnew/conferences/?cid=2" title="Conferences/Training">Conferences/Training</a> <a href="//ies.ed.gov/newsflash/#nces" title="NewsFlash">NewsFlash</a> <a href="/whatsnew/Solicitations.asp" title="Funding Opportunities">Funding Opportunities</a> <a href="/whatsnew/NCESNews.asp" title="Press Releases">Press Releases</a> <a href="/whatsnew/statchat/index.asp" title="StatChat">StatChat</a></li>
          </ul></li>
         <li><a href="/pubsearch/">Publications &amp; Products</a>
          <ul class="clearfix">
           <li class="left_col"><a href="/pubsearch/" title="Search Publications and Products">Search Publications and Products</a> <a href="/annuals/" title="Publications">Annual Reports</a> <a href="/pubsearch/licenses.asp" title="Restricted-use Data Licenses">Restricted-use Data Licenses</a> <br><a href="/pubsearch/index.asp?searchcat2=pubslast90&amp;HasSearched=1" title="Recent Publications">Recent Publications</a> <a href="/pubsearch/Subindx.asp" title="By Subject Index A-Z">By Subject Index A-Z</a> <a href="/pubsearch/surveylist.asp" title="By Survey &amp; Program Areas">By Survey &amp; Program Areas</a> <a href="/pubsearch/index.asp?searchcat2=pubslast6month&amp;HasSearched=1" title="Data Products Last 6 Months">Data Products Last 6 Months</a></li><!--
									<li class="right_col">
										<a href="/pubsearch/pubsinfo.asp?pubid=2012026"><img src="/images/hfs/f/ay_small.gif" alt="America's Youth: Transitions to Adulthood"></a><br><a href="/pubsearch/pubsinfo.asp?pubid=2012026">
									 America's Youth:<br>Transitions to Adulthood
										</a>
									</li> -->
          </ul></li>
         <li><a href="#" class="nces_about">About Us</a>
          <ul class="clearfix">
           <li class="left_col"><a href="/about/" title="About NCES">About NCES</a> <a href="/whatsnew/commissioner/index.asp" title="Commissioner">Commissioner</a> <a href="/help/webmail/" title="Contact NCES">Contact NCES</a> <a href="/staff/stafflist.asp" title="Staff">Staff</a> <a href="/help" title="Help">Help</a></li>
          </ul></li>
        </ul>
        <div class="common_main_nav">
         <div class="common_links">
          <a href="/help/webmail/">Contact</a>
          <br><a href="/datatools/">Tools</a>
          <br><a href="https://www.ed.gov/">ED.gov</a>
          <br><a href="//ies.ed.gov/newsflash/#nces">Newsflash</a>
         </div>
         <div class="social_links">
          <a href="/blogs/nces/">NCES Blog</a>
          <br><a href="https://twitter.com/EdNCES"><img src="/images/icons/twitterNav.png" alt="Twitter logo"></a> <a href="https://twitter.com/EdNCES">Twitter</a>
          <br><a href="https://www.facebook.com/EdNCES/"><img src="/images/icons/facebookNav.png" alt="Facebook logo"></a> <a href="https://www.facebook.com/EdNCES/">Facebook</a>
         </div>
         <div class="social_links">
          <a href="/nceskids/" class="kidszone"><img src="/images/icons/NCESkidszone.gif" alt="KidsZone logo"></a>
         </div>
        </div>
       </div>
      </div>
      <div class="site_search">
       <a href="#" class="mob_search"><img src="/images/icons/searchIcon.png" alt="Search IES"></a>
       <form onsubmit="return hfsIsSearchValid(this);" method="get" action="/search/search_redirect.asp" name="HeaderSearch">
        <label for="HFSSearchBox" style="display:none;">Search box</label><input type="text" value="Search" id="HFSSearchBox" name="Search"><input type="hidden" value="NCES" name="website"><input type="submit" value="Go" class="submitBtn search-link">
       </form>
      </div>
     </div>
    </div>
   </div><!-- closing header div -->
  </div><!-- HEADER ENDS HERE-->
  <div class="container app aris">
   <div class="header-wrapper">
    <div class="top-header">
     <h5>Annual Reports and Information Staff (Annual Reports)</h5>
     <div class="social-wrap">
      <div class="social-links">
       <div class="social-link">
        <span class="tooltiptext">Contact NCES</span> <a target="_blank" href="/surveys/annualreports/contact" data-ev data-ev-n="click" data-ev-c="outreach" data-ev-l="contact-us"><img src="/programs/coe/images/envelope.svg" data-src="/programs/coe/images/envelope.svg" data-over-src="/programs/coe/images/envelope-hover.svg" alt="Contact NCES" onmouseover="iap_social(event)" onmouseout="iap_social(event)"></a>
       </div>
       <div class="social-link">
        <span class="tooltiptext">EdNCES Twitter</span> <a target="_blank" href="https://twitter.com/EdNCES" data-ev data-ev-n="click" data-ev-c="outreach" data-ev-l="twitter"><img src="/programs/coe/images/twitter-nav.svg" data-src="/programs/coe/images/twitter-nav.svg" data-over-src="/programs/coe/images/twitter-nav-hover.svg" alt="EdNCES Twitter" onmouseover="iap_social(event)" onmouseout="iap_social(event)"></a>
       </div>
       <div class="social-link">
        <span class="tooltiptext">EdNCES Facebook</span> <a target="_blank" href="https://www.facebook.com/EdNCES/" data-ev data-ev-n="click" data-ev-c="outreach" data-ev-l="facebook"><img src="/programs/coe/images/facebook-square.svg" data-src="/programs/coe/images/facebook-square.svg" data-over-src="/programs/coe/images/facebook-square-hover.svg" onmouseover="iap_social(event)" onmouseout="iap_social(event)" alt="EdNCES Facebook"></a>
       </div>
       <div class="social-link">
        <span class="tooltiptext">EdNCES LinkedIn</span> <a target="_blank" href="https://www.linkedin.com/company/ednces/" data-ev data-ev-n="click" data-ev-c="outreach" data-ev-l="linkedin"><img src="/programs/coe/images/linkedin.svg" data-src="/programs/coe/images/linkedin.svg" data-over-src="/programs/coe/images/linkedin-hover.svg" onmouseover="iap_social(event)" onmouseout="iap_social(event)" alt="EdNCES LinkedIn" class="linkedin"></a>
       </div>
       <div class="social-link">
        <span class="tooltiptext">EdNCES YouTube</span> <a target="_blank" href="https://www.youtube.com/c/EdNCES/featured" data-ev data-ev-n="click" data-ev-c="outreach" data-ev-l="ednces-youtube"> <img src="/programs/coe/images/youtube-nav.svg" data-src="/programs/coe/images/youtube-nav.svg" data-over-src="/programs/coe/images/youtube-nav-hover.svg" onmouseover="iap_social(event)" onmouseout="iap_social(event)" alt="EdNCES YouTube" style="width: 25px;"> </a>
       </div>
      </div>
     </div>
    </div>
    <nav class="no-underline">
     <div class="burger-wrap">
      <div class="burger-icon" data-toggle-mobile-menu></div>
     </div>
     <ul>
      <li data-nav-item="home" class=""><a href="/surveys/annualreports" title="Home page">
        <div class="home-image" title="Home page"></div></a></li>
      <li data-nav-item="about">
       <div class="dropdown" id="about-dropdown">
        <a class="dropdown-toggle" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> About </a>
        <div class="dropdown-menu" id="about-menu" aria-labelledby="dropdownMenuLink">
         <a class="dropdown-item" href="/surveys/annualreports/overview">Overview</a> <a class="dropdown-item" href="/surveys/annualreports/contact">Connect With Annual Reports</a>
        </div>
       </div></li>
      <li class="active" title="Annually updated indicators that track key developments in the U.S. education system"><a href="/programs/coe/" data-ev data-ev-n="click" data-ev-c="nav" data-ev-l="coe">Condition of Education</a></li>
      <li class="" title="Tabular data covering all levels of education"><a href="https://nces.ed.gov/programs/digest">Digest of Education Statistics</a></li>
      <li class="" title="Forecasts of enrollment, graduates, teachers, and expenditures"><a href="https://nces.ed.gov/programs/pes">Projections</a></li>
      <li data-nav-item="Topical studies" title="More detailed reports and tables than Condition of Education">
       <div class="dropdown" id="topicalStudies-dropdown">
        <a class="dropdown-toggle" role="button" id="topicalStudiesMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> Topical Studies </a>
        <div class="dropdown-menu" id="topicalStudies-menu" aria-labelledby="dropdownMenuLink">
         <a class="dropdown-item" href="/surveys/annualreports/topical-studies/covid/">COVID-19 and Education</a> <a class="dropdown-item" href="/surveys/annualreports/topical-studies/locale">Education Across America</a> <a class="dropdown-item" href="/surveys/annualreports/topical-studies/retrospective/" )>Retrospective on Education Statistics </a> <a class="dropdown-item" href="/surveys/annualreports/topical-studies/summary">More</a>
        </div>
       </div></li>
      <li><a href="https://nces.ed.gov/pubsearch/getpubcats.asp?sid=091">Publications</a></li>
      <li class="mobile-social-link"><a href="https://ies.ed.gov/newsflash/#nces" target="_blank" data-ev data-ev-name="click" data-ev-props="join-newsflash">Join Newsflash</a></li>
      <li class="mobile-social-link"><a target="_blank" href="/surveys/annualreports/contact" data-ev data-ev-name="click" data-ev-props="contact-us">Contact Us</a></li>
      <li class="mobile-social-link"><a target="_blank" href="https://nces.ed.gov/blogs/nces/" data-ev data-ev-name="click" data-ev-props="nces-blogs">NCES Blog</a></li>
      <li class="mobile-social-link"><a target="_blank" href="https://twitter.com/EdNCES" data-ev data-ev-name="click" data-ev-props="twitter"><img src="/programs/coe/images/twitter-nav-white.svg" alt=""> Twitter</a></li>
      <li class="mobile-social-link"><a target="_blank" href="https://www.facebook.com/EdNCES/" data-ev data-ev-name="click" data-ev-props="facebook"><img src="/programs/coe/images/facebook-square-white.svg" alt=""> Facebook</a></li>
      <li class="mobile-social-link"><a target="_blank" href="https://www.youtube.com/c/EdNCES/featured" data-ev data-ev-name="click" data-ev-props="youtube"><img src="/programs/coe/images/youtube-nav-white.svg" alt=""> YouTube</a></li>
     </ul>
    </nav>
   </div><a id="top"></a>
   <div class="indicator-wrapper yellow">
    <div class="d-flex">
     <script>
    function treeElementClick(ev, treeElementId) {
        if (ev.target.nodeName !== 'A') {
            ev.preventDefault();
            ev.stopPropagation();
        }

        var selector = $(ev.target);
        var child = $(selector).closest("h6");
        if (child && !$(child).hasClass('has-child')) {
            $(child).toggleClass('m-h');
        }
        $(selector).closest("li").toggleClass('active').find('> ul').toggle();
    }

    function activeCollapsedMenu(item) {
        var collapsedIndex = $(item).closest(".topic-root").index() - 1; // hidden item for mobile
        $(".collapsed-menu > ul > li").eq(collapsedIndex).addClass("active");
    }

    function toggleClosestHeader(item) {
        var parentElement = $(item).parent("ul").prev();
        if (!$(parentElement).hasClass('has-child')) {
            $(parentElement).toggleClass('m-h');
        }
    }

    function toggleParents(item) {
        var parents = $(item).parentsUntil(".main-list", "li");
        parents.each(function (index, s) {
            if (s) {
                $(s).toggleClass('active').find('> ul').toggle();
            }
        });
    }

    function toggleItemMenu(item, rootTopicId) {
        var currentRootId = $(item).closest(".topic-root").attr("data-id");
        if (currentRootId === rootTopicId && currentRootId) {
            activeCollapsedMenu(item);
            toggleClosestHeader(item);
            toggleParents(item);
        } else {
            $(item).removeClass("active");
        }

        // update image on collapsed menu
        let img = $('.collapsed-menu').find('li.active').find('img');
        let src = img.attr('src');
        let hoverSrc = img.attr('data-image-hover');
        img.attr('data-image-hover', src);
        img.attr('src', hoverSrc);

    }

    function toggleFirstItem() {
        var selector = $(".indicator-links").find("li.active").eq(0); // select the first item if tid is not provided
        var selectorRootTopicId = $(selector).closest(".topic-root").attr("data-id");
        toggleItemMenu(selector, selectorRootTopicId);
        $(".indicator-links").find("li.active").not(selector).removeClass("active");
    }

    window.addEventListener('load', function () {
        var rootTopicId = "";
        if (0 > 0) {
            $("li#li-" + 0).toggleClass('active').find('> ul').toggle();
        }
        if (rootTopicId) {
            if (rootTopicId === "300") { // TODO: remove hardcoded spotlight root id
                var spotlightActive = $(".spotlight-link").hasClass("active");
                if (spotlightActive) {
                    var mainContainer = $(".spotlight-link").parent().parent();
                    $(mainContainer).addClass('active').find('> ul').toggle();
                    $(".spotlight-collapsed").addClass('active');
                }
            }
            var selectors = $(".indicator-links").find("li.active");
            selectors.each(function (_, item) {
                toggleItemMenu(item, rootTopicId);
            });
        } else {
            toggleFirstItem();
        }

        var origin;
        $(".collapsed-menu li").hover(function () {
            if (!$(this).hasClass('active')) {
                var img = $(this).find("img");
                origin = $(img).attr("src");
                $(img).attr("src", $(img).attr("data-image-hover"));
                $(this).prev().addClass("previous");
            }

        }, function () {
            if (!$(this).hasClass("active")) {
                $(this).prev().removeClass("previous");
                var img = $(this).find("img");
                $(img).attr("src", origin);
            }
        });

        $(".collapsed-menu > ul > li").click(function () {
            if (false) {
                const url = $(this).attr('data-topic-url');
                window.location.href = url;
            }
            else {
                var index = $(this).index() + 1;
                var _selector = $(".main-list > li");
                $(".menu").show();
                $(".collapsed-menu").hide();
                _selector.removeClass('active').find('> ul').hide();
                _selector.eq(index).toggleClass('active').find('> ul').toggle();
                if ($(this).attr('id') === 'collapsed-menu-related-sites') {
                    _selector.removeClass('active');
                }

                $("[data-collapse-indicator-menu]").text("Collapse");
            }
        });
    });

</script>
     <div class="menu-wrap">
      <button class="button button--small collapse-btn" data-collapse-indicator-menu>Collapse</button>
      <div class="menu">
       <!-- level 1 -->
       <ul class="main-list">
        <li class="mobile-menu-header">
         <h4>COE Indicators</h4><span class="indicator-menu-mobile-close" data-indicator-menu-mobile-close></span></li>
        <li id="li-1" onclick="treeElementClick(event, '1')" class="topic-root yellow" data-id="1">
         <h5>Family Characteristics</h5>
         <ul style="display: none;" class="indicators indicator-links">
          <li class=""><a href="/programs/coe/indicator/cce/family-characteristics">Characteristics of Children’s Families </a></li>
          <li class=""><a href="/programs/coe/indicator/sga/family-education-activities">Family Involvement in Education-Related Activities Outside of School</a></li>
         </ul></li>
        <li id="li-4" onclick="treeElementClick(event, '4')" class="topic-root yellow" data-id="4">
         <h5>Preprimary, Elementary, and Secondary Education</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Preprimary Education (4)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/tca/early-childhood-care">Early Childhood Care Arrangements: Choices and Costs</a></li>
            <li class=""><a href="/programs/coe/indicator/sfa/home-literacy-activities">Home Literacy Activities With Young Children</a></li>
            <li class=""><a href="/programs/coe/indicator/cfa/enrollment-of-young-children">Enrollment Rates of Young Children</a></li>
            <li class=""><a href="/programs/coe/indicator/lca/early-childhood-care-rural?tid=4">Early Childhood Care and Education Programs in Rural Areas</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Elementary and Secondary Enrollment (7)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cga/public-school-enrollment">Public School Enrollment</a></li>
            <li class=""><a href="/programs/coe/indicator/cgb/public-charter-enrollment">Public Charter School Enrollment</a></li>
            <li class=""><a href="/programs/coe/indicator/cgf/english-learners">English Learners in Public Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/cge/racial-ethnic-enrollment">Racial/Ethnic Enrollment in Public Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/cgc/private-school-enrollment">Private School Enrollment</a></li>
            <li class=""><a href="/programs/coe/indicator/tgk/homeschooled-children">Homeschooled Children and Reasons for Homeschooling</a></li>
            <li class=""><a href="/programs/coe/indicator/cgg/students-with-disabilities">Students With Disabilities</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Schools and Districts (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cla/elementary-secondary-schools">Characteristics of Elementary and Secondary Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/clb/free-or-reduced-price-lunch">Concentration of Public School Students Eligible for Free or Reduced-Price Lunch</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> School Crime and Safety</h6><!-- level 3 -->
           <ul style="display: none;" class="level3">
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Violent Deaths (1)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a01/violent-deaths-and-shootings?tid=4">Violent Deaths at School and Away From School and School Shootings</a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Nonfatal Student and Teacher Victimization (4)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a02/victimization-at-away-from-school?tid=4">Incidence of Victimization at School and Away From School </a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a03/victimization-at-school?tid=4">Prevalence of Criminal Victimization at School</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a04/threats-injuries-with-weapon?tid=4">Threats and Injuries With Weapons on School Property</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a05/teacher-attacked-by-students?tid=4">Teachers Threatened With Injury or Physically Attacked by Students</a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">School Environment (6)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a06/criminal-incidents?tid=4">Criminal Incidents Recorded by Public Schools and Those Reported to Sworn Law Enforcement</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a07/discipline-problems?tid=4">Discipline Problems Reported by Public Schools</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a08/gangs-at-school?tid=4">Students’ Reports of Gangs at School</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a09/hate-related-words-graffiti?tid=4">Students’ Reports of Hate-Related Words and Hate-Related Graffiti</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a10/bullying-electronic-bullying?tid=4">Bullying at School and Electronic Bullying</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a11/teacher-manage-classroom-behavior?tid=4">Teachers’ Reports on Managing Classroom Behaviors</a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Fights, Weapons, and Illegal Substances (4)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a12/physical-fights?tid=4">Physical Fights on School Property and Anywhere</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a13/student-weapons-firearms?tid=4">Students Carrying Weapons and Students’ Access to Firearms</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a14/student-alcohol-use?tid=4">Students’ Use of Alcohol</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a15/marijuana-use-drug-availability?tid=4">Marijuana Use and Illegal Drug Availability</a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Fear and Avoidance (2)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a16/student-perception-of-safety?tid=4">Students’ Perceptions of Personal Safety at School and Away From School</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a17/student-school-avoidance?tid=4">Students’ Reports of Avoiding School Activities or Classes or Specific Places in School </a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Discipline, Safety, and Health Practices (4)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a18/serious-disciplinary-actions?tid=4">Serious Disciplinary Actions Taken by Public Schools</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a19/school-reported-safety-practices?tid=4">Safety and Security Practices at Public Schools</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a20/student-reported-safety-measures?tid=4">Students’ Reports of Safety and Security Measures Observed at School</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/a23/school-mental-health-services?tid=4">Prevalence of Mental Health Services Provided by Public Schools and Limitations in Schools’ Efforts to Provide Mental Health Services</a></li>
             </ul></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Technology (3)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/tcb/covid-impact-elementary-secondary">Impact of the Coronavirus Pandemic on the Elementary and Secondary Education System </a></li>
            <li class=""><a href="/programs/coe/indicator/cch/home-internet-access">Children’s Internet Access at Home</a></li>
            <li class=""><a href="/programs/coe/indicator/lfc/internet-access-students-rural?tid=4">Rural Students’ Access to the Internet</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Teachers and Staff (8)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/clr/public-school-teachers">Characteristics of Public School Teachers</a></li>
            <li class=""><a href="/programs/coe/indicator/sld/public-private-school-teachers">Characteristics of Traditional Public, Public Charter, and Private School Teachers</a></li>
            <li class=""><a href="/programs/coe/indicator/tlc/alternative-route-certification">Characteristics of Public School Teachers Who Completed Alternative Route to Certification Programs</a></li>
            <li class=""><a href="/programs/coe/indicator/tls/elem-sec-teacher-openings?tid=4">Teacher Openings in Elementary and Secondary Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/cls/public-school-principals">Characteristics of Public and Private School Principals</a></li>
            <li class=""><a href="/programs/coe/indicator/slc/teacher-turnover">Teacher Turnover: Stayers, Movers, and Leavers</a></li>
            <li class=""><a href="/programs/coe/indicator/slb/principal-turnover">Principal Turnover: Stayers, Movers, and Leavers</a></li>
            <li class=""><a href="/programs/coe/indicator/lle/staff-schools-rural?tid=4">Staff in Rural Public Elementary and Secondary School Systems</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Student Learning</h6><!-- level 3 -->
           <ul style="display: none;" class="level3">
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Assessments (8)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cnb/reading-performance">Reading Performance</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cnc/mathematics-performance">Mathematics Performance</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cne/science-performance">Science Performance</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/snd/technology-engineering-literacy">Technology and Engineering Literacy</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cnj/reading-math-score-trends">Reading and Mathematics Score Trends</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cns/intl-grade4-reading?tid=4">International Comparisons: Reading Literacy at Grade 4</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cnt/intl-grades-4-8-math-science?tid=4">International Comparisons: Mathematics and Science Achievement at Grades 4 and 8</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/cnu/intl-age15-literacy?tid=4">International Comparisons: Reading, Mathematics, and Science Literacy of 15-Year-Old Students</a></li>
             </ul></li>
            <li onclick="treeElementClick(event)">
             <h6 class="d-flex">Courses and School Supports (2)</h6><!-- level 4 -->
             <ul style="display: none;" class="indicators indicator-links">
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/toa/k-12-covid-recovery?tid=4">Recovery From the Coronavirus Pandemic in K–12 Education</a></li>
              <li onclick="treeElementClick(event)" class=""><a href="/programs/coe/indicator/sod/high-school-courses">High School Mathematics and Science Course Completion</a></li>
             </ul></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> High School Persistence and Completion (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/coj/status-dropout-rates">Status Dropout Rates</a></li>
            <li class=""><a href="/programs/coe/indicator/coi/high-school-graduation-rates">Public High School Graduation Rates</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Finances and Governance (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cma/public-school-revenue">Public School Revenue Sources</a></li>
            <li class=""><a href="/programs/coe/indicator/cmb/public-school-expenditure">Public School Expenditures</a></li>
           </ul></li>
         </ul></li>
        <li id="li-74" onclick="treeElementClick(event, '74')" class="topic-root yellow" data-id="74">
         <h5>Postsecondary Education</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Postsecondary Students (8)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cpa/immediate-college-enrollment-rate">Immediate College Enrollment Rate</a></li>
            <li class=""><a href="/programs/coe/indicator/cpb/college-enrollment-rate">College Enrollment Rates</a></li>
            <li class=""><a href="/programs/coe/indicator/tpb/covid-impact-postsecondary-plans">Impact of the Coronavirus Pandemic on Fall Plans for Postsecondary Education</a></li>
            <li class=""><a href="/programs/coe/indicator/cha/undergrad-enrollment">Undergraduate Enrollment</a></li>
            <li class=""><a href="/programs/coe/indicator/chb/postbaccalaureate-enrollment">Postbaccalaureate Enrollment</a></li>
            <li class=""><a href="/programs/coe/indicator/csb/postsecondary-students">Characteristics of Postsecondary Students</a></li>
            <li class=""><a href="/programs/coe/indicator/ssa/college-student-employment">College Student Employment</a></li>
            <li class=""><a href="/programs/coe/indicator/lbb/postsecondary-enrollment-rural?tid=74">Postsecondary Enrollment Status of Youth From Rural Areas</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Institutions (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/csa/postsecondary-institutions">Characteristics of Degree-Granting Postsecondary Institutions</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Campus Crime and Safety (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a21/postsecondary-criminal-incidents?tid=74">Criminal Incidents at Postsecondary Institutions </a></li>
            <li class=""><a href="/programs/coe/indicator/a22/postsecondary-hate-crimes?tid=74">Hate Crime Incidents at Postsecondary Institutions </a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Faculty and Staff (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/csc/postsecondary-faculty">Characteristics of Postsecondary Faculty</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Completions and Graduation Rates (5)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cts/postsecondary-certificate-degree">Postsecondary Certificates and Degrees Conferred </a></li>
            <li class=""><a href="/programs/coe/indicator/cta/undergrad-degree-fields">Undergraduate Degree Fields</a></li>
            <li class=""><a href="/programs/coe/indicator/ctb/graduate-degree-fields">Graduate Degree Fields </a></li>
            <li class=""><a href="/programs/coe/indicator/ctr/undergrad-retention-graduation">Undergraduate Retention and Graduation Rates</a></li>
            <li class=""><a href="/programs/coe/indicator/tta/nontraditional-undergraduates">Postsecondary Outcomes for Nontraditional Undergraduate Students</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Finances and Resources (6)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cua/undergrad-costs">Price of Attending an Undergraduate Institution</a></li>
            <li class=""><a href="/programs/coe/indicator/cub/undergrad-student-loans">Loans for Undergraduate Students and Debt for Bachelor’s Degree Recipients</a></li>
            <li class="active"><a href="/programs/coe/indicator/cuc/financial-aid-sources">Sources of Financial Aid</a></li>
            <li class=""><a href="/programs/coe/indicator/tub/graduate-student-loan-debt">Trends in Student Loan Debt for Graduate School Completers</a></li>
            <li class=""><a href="/programs/coe/indicator/cud/postsecondary-institution-revenue">Postsecondary Institution Revenues </a></li>
            <li class=""><a href="/programs/coe/indicator/cue/postsecondary-institution-expense">Postsecondary Institution Expenses </a></li>
           </ul></li>
         </ul></li>
        <li id="li-104" onclick="treeElementClick(event, '104')" class="topic-root yellow" data-id="104">
         <h5>Population Characteristics and Economic Outcomes</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Population Characteristics (3)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/caa/young-adult-attainment">Educational Attainment of Young Adults</a></li>
            <li class=""><a href="/programs/coe/indicator/sae/nondegree-work-credentials">Nondegree Work Credentials and Work Experience Programs</a></li>
            <li class=""><a href="/programs/coe/indicator/lbc/educational-attainment-rural?tid=104">Educational Attainment in Rural Areas</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Economic Outcomes (5)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cbc/employment-unemployment-rates">Employment and Unemployment Rates by Educational Attainment</a></li>
            <li class=""><a href="/programs/coe/indicator/sbc/bachelor-degree-holder-outcomes">Employment Outcomes of Bachelor’s Degree Holders</a></li>
            <li class=""><a href="/programs/coe/indicator/cba/annual-earnings">Annual Earnings by Educational Attainment</a></li>
            <li class=""><a href="/programs/coe/indicator/tbe/outcomes-by-socioeconomic-status">Young Adult Educational and Employment Outcomes by Family Socioeconomic Status</a></li>
            <li class=""><a href="/programs/coe/indicator/col/not-in-school-not-working-neet">Young Adults Neither Enrolled in School nor Working</a></li>
           </ul></li>
         </ul></li>
        <li id="li-114" onclick="treeElementClick(event, '114')" class="topic-root yellow" data-id="114">
         <h5>International Comparisons</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Assessments (3)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cns/intl-grade4-reading?tid=114">International Comparisons: Reading Literacy at Grade 4</a></li>
            <li class=""><a href="/programs/coe/indicator/cnt/intl-grades-4-8-math-science?tid=114">International Comparisons: Mathematics and Science Achievement at Grades 4 and 8</a></li>
            <li class=""><a href="/programs/coe/indicator/cnu/intl-age15-literacy?tid=114">International Comparisons: Reading, Mathematics, and Science Literacy of 15-Year-Old Students</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Enrollment and Attainment (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cgh/enrollment-rates-by-country">Enrollment Rates by Country</a></li>
            <li class=""><a href="/programs/coe/indicator/cac/intl-ed-attainment">International Educational Attainment</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Finances (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/cmd/education-expenditures-by-country">Education Expenditures by Country</a></li>
           </ul></li>
         </ul></li>
        <li id="li-200" onclick="treeElementClick(event, '200')" class="topic-root yellow" data-id="200">
         <h5>School Crime and Safety</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Violent Deaths (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a01/violent-deaths-and-shootings?tid=200">Violent Deaths at School and Away From School and School Shootings</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Nonfatal Student and Teacher Victimization (4)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a02/victimization-at-away-from-school?tid=200">Incidence of Victimization at School and Away From School </a></li>
            <li class=""><a href="/programs/coe/indicator/a03/victimization-at-school?tid=200">Prevalence of Criminal Victimization at School</a></li>
            <li class=""><a href="/programs/coe/indicator/a04/threats-injuries-with-weapon?tid=200">Threats and Injuries With Weapons on School Property</a></li>
            <li class=""><a href="/programs/coe/indicator/a05/teacher-attacked-by-students?tid=200">Teachers Threatened With Injury or Physically Attacked by Students</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> School Environment (6)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a06/criminal-incidents?tid=200">Criminal Incidents Recorded by Public Schools and Those Reported to Sworn Law Enforcement</a></li>
            <li class=""><a href="/programs/coe/indicator/a07/discipline-problems?tid=200">Discipline Problems Reported by Public Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/a08/gangs-at-school?tid=200">Students’ Reports of Gangs at School</a></li>
            <li class=""><a href="/programs/coe/indicator/a09/hate-related-words-graffiti?tid=200">Students’ Reports of Hate-Related Words and Hate-Related Graffiti</a></li>
            <li class=""><a href="/programs/coe/indicator/a10/bullying-electronic-bullying?tid=200">Bullying at School and Electronic Bullying</a></li>
            <li class=""><a href="/programs/coe/indicator/a11/teacher-manage-classroom-behavior?tid=200">Teachers’ Reports on Managing Classroom Behaviors</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Fights, Weapons, and Illegal Substances (4)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a12/physical-fights?tid=200">Physical Fights on School Property and Anywhere</a></li>
            <li class=""><a href="/programs/coe/indicator/a13/student-weapons-firearms?tid=200">Students Carrying Weapons and Students’ Access to Firearms</a></li>
            <li class=""><a href="/programs/coe/indicator/a14/student-alcohol-use?tid=200">Students’ Use of Alcohol</a></li>
            <li class=""><a href="/programs/coe/indicator/a15/marijuana-use-drug-availability?tid=200">Marijuana Use and Illegal Drug Availability</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Fear and Avoidance (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a16/student-perception-of-safety?tid=200">Students’ Perceptions of Personal Safety at School and Away From School</a></li>
            <li class=""><a href="/programs/coe/indicator/a17/student-school-avoidance?tid=200">Students’ Reports of Avoiding School Activities or Classes or Specific Places in School </a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Discipline, Safety, and Health Practices (4)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a18/serious-disciplinary-actions?tid=200">Serious Disciplinary Actions Taken by Public Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/a19/school-reported-safety-practices?tid=200">Safety and Security Practices at Public Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/a20/student-reported-safety-measures?tid=200">Students’ Reports of Safety and Security Measures Observed at School</a></li>
            <li class=""><a href="/programs/coe/indicator/a23/school-mental-health-services?tid=200">Prevalence of Mental Health Services Provided by Public Schools and Limitations in Schools’ Efforts to Provide Mental Health Services</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Campus Crime and Safety (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/a21/postsecondary-criminal-incidents?tid=200">Criminal Incidents at Postsecondary Institutions </a></li>
            <li class=""><a href="/programs/coe/indicator/a22/postsecondary-hate-crimes?tid=200">Hate Crime Incidents at Postsecondary Institutions </a></li>
           </ul></li>
         </ul></li>
        <li id="li-1000" onclick="treeElementClick(event, '1000')" class="topic-root yellow" data-id="1000">
         <h5>Education Across America</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Family Characteristics (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/lfc/internet-access-students-rural?tid=1000">Rural Students’ Access to the Internet</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Educational Experiences (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/lca/early-childhood-care-rural?tid=1000">Early Childhood Care and Education Programs in Rural Areas</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> School Resources and Staffing (1)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/lle/staff-schools-rural?tid=1000">Staff in Rural Public Elementary and Secondary School Systems</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> Educational Outcomes (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/lbb/postsecondary-enrollment-rural?tid=1000">Postsecondary Enrollment Status of Youth From Rural Areas</a></li>
            <li class=""><a href="/programs/coe/indicator/lbc/educational-attainment-rural?tid=1000">Educational Attainment in Rural Areas</a></li>
           </ul></li>
         </ul></li>
        <li id="li-300" onclick="treeElementClick(event, '300')" class="topic-root yellow" data-id="300">
         <h5>Spotlight</h5><!-- level 2 -->
         <ul style="display: none;" class="level2">
          <li onclick="treeElementClick(event)">
           <h6 class="d-flex m-h has-child"><img src="/programs/coe/images/icon-plus.svg" class="icon-plus" alt="Expand list"> <img src="/programs/coe/images/icon-minus.svg" class="icon-minus" alt="Collapse list"> 2023 Spotlights (2)</h6><!-- level 3 -->
           <ul style="display: none;" class="indicators indicator-links">
            <li class=""><a href="/programs/coe/indicator/tls/elem-sec-teacher-openings?tid=300">Teacher Openings in Elementary and Secondary Schools</a></li>
            <li class=""><a href="/programs/coe/indicator/toa/k-12-covid-recovery?tid=300">Recovery From the Coronavirus Pandemic in K–12 Education</a></li>
           </ul></li>
          <li onclick="treeElementClick(event)" class="spotlight-link ">
           <h6><a href="/programs/coe/indicator/spotlight-archive?tid=300">Spotlight Archive</a></h6></li>
         </ul></li>
        <li class="related-sites">
         <div>
          <h4>Related sites</h4>
          <ul>
           <li>
            <h5><a href="/programs/coe/pdf/ataglance_508.pdf" target="_blank" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="at-a-glance">Condition of Education At a Glance</a></h5></li>
           <li>
            <h5><a href="/programs/coe/guide" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="reader-guide">Reader’s Guide </a></h5></li>
           <li>
            <h5><a href="/programs/coe/sources">Guide to Sources</a></h5></li>
           <li>
            <h5><a href="/programs/coe/glossary">Glossary</a></h5></li>
           <li>
            <h5><a href="https://nces.ed.gov/ipeds/" target="_blank" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="survey-link"> Go to the Integrated Postsecondary Education Data System (IPEDS) Website </a></h5></li>
           <li>
            <h5><a href="/programs/digest/" target="_blank" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="digest-tables">Digest Tables</a></h5></li>
           <li>
            <h5><a href="/pubsearch/getpubcats.asp?sid=091" target="_blank" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="annual-reports-publications">Annual Reports Publications &amp; Products</a></h5></li>
           <li>
            <h5><a href="/fastfacts/" target="_blank" data-ev data-ev-n="click" data-ev-c="related-sites" data-ev-l="fast-facts">Fast Facts</a></h5></li>
          </ul>
         </div></li>
       </ul>
      </div>
      <div class="collapsed-menu">
       <ul class="d-flex flex-column justify-content-center align-content-center">
        <li class=" " data-topic-url="/programs/coe/family">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/fam-icon.svg" data-image-hover="/programs/coe/images/fam-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2 class="text-black">Family <br>
             Characteristics</h2>
          </div>
         </div></li>
        <li class="previous " data-topic-url="/programs/coe/preprimary-elementary-and-secondary">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/preprim-icon-white.svg" data-image-hover="/programs/coe/images/preprim-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>Preprimary, Elementary, <br>
             and Secondary Education</h2>
          </div>
         </div></li>
        <li class=" " data-topic-url="/programs/coe/postsecondary">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/postsec-icon-white.svg" data-image-hover="/programs/coe/images/postsec-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>Postsecondary <br>
             Education</h2>
          </div>
         </div></li>
        <li class=" " data-topic-url="/programs/coe/population-and-economic-outcomes">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/pop-icon-white.svg" data-image-hover="/programs/coe/images/pop-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>Population Characteristics <br>
             and Economic Outcomes</h2>
          </div>
         </div></li>
        <li class=" " data-topic-url="/programs/coe/international">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/international-icon-white.svg" data-image-hover="/programs/coe/images/international-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>International <br>
             Comparisons</h2>
          </div>
         </div></li>
        <li class=" " data-topic-url="/programs/coe/crime-and-safety">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/school-crime-white.svg" data-image-hover="/programs/coe/images/school-crime-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>School Crime <br>
             and Safety</h2>
          </div>
         </div></li>
        <li class=" " data-topic-url="/programs/coe/locale">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/map-hover-sidebar.svg" data-image-hover="/programs/coe/images/map.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>Education Across<br>
             America</h2>
          </div>
         </div></li>
        <li class="spotlight-collapsed  " data-topic-url="/programs/coe/spotlight">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/spotlight-white.svg" data-image-hover="/programs/coe/images/spotlight-hover-sidebar.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2 class="mt-2">Spotlight</h2>
          </div>
         </div></li>
        <li id="collapsed-menu-related-sites">
         <div class="d-flex align-content-center">
          <img src="/programs/coe/images/share-link-sidebar.svg" data-image-hover="/programs/coe/images/share-link-sidebar-hover.svg" alt="">
          <div class="menu-title flex-grow-1">
           <h2>Related <br>
             sites</h2>
          </div>
         </div></li>
       </ul>
      </div>
     </div>
     <div class="info flex-grow-1">
      <div class="d-flex title-indicator">
       <img src="/programs/coe/images/postsec-icon.svg" alt="">
       <h6 class="flex-grow-1">Postsecondary Education</h6>
       <div class="indicator-menu-mobile" data-indicator-menu-mobile></div>
      </div>
      <h2 class="title mb-3" data-id="1072">Sources of Financial Aid</h2>
      <div class="d-flex align-items-center">
       <div class="flex-grow-1">
        <div class="d-flex mt-15">
         <div class="last-updated">
          Last Updated: May 2022
         </div>
         <div class="ml-2 mr-2 separator">
          |
         </div>
         <div>
          <a href="#suggested-citation">Suggested citation</a>
         </div>
        </div>
       </div>
       <div class="pt-2 d-none d-md-block d-lg-block">
        <a data-ev data-ev-n="click" data-ev-c="download" data-ev-l="pdf" href="https://nces.ed.gov/programs/coe/pdf/2022/cuc_508.pdf" target="_blank" class="button button--large no-underline download-pdf">Download PDF</a>
       </div>
      </div>
      <div class="pt-2 d-sm-block d-md-none">
       <a data-ev data-ev-n="click" data-ev-c="download" data-ev-l="pdf" href="https://nces.ed.gov/programs/coe/pdf/2022/cuc_508.pdf" target="_blank" class="button button--large no-underline download-pdf">Download PDF</a>
      </div>
      <p class="note" data-p="0" data-c-id="1450" data-c-seq="1">At 4-year degree-granting postsecondary institutions, the percentage of first-time, full-time degree/certificate-seeking undergraduate students who were awarded financial aid in academic year 2019–20 was higher at private nonprofit institutions (90 percent) than at private for-profit institutions (87 percent) and public institutions (85 percent).</p>
      <p class="" data-p="1" data-c-id="1451" data-c-seq="2">Grants and loans are the major forms of federal financial aid for first-time, full-time degree/certificate-seeking undergraduate students. These are distinct forms of financial aid. Loans typically have to be repaid, whereas grants do not. The largest federal grant program available to undergraduate students is the Federal Pell Grant program. A student must demonstrate financial need to qualify for a Federal Pell Grant. Some federal loan programs are available to all students, and some are based on financial need. Other sources of financial aid include state and local governments, institutions, and private sources, as well as private loans. The forms of financial aid discussed in this indicator are only those provided directly to students. For example, student loans include only loans for which the student is the designated borrower. Student loans do not include Direct PLUS Loans<sup><a href="#fn1" name="fr1">1</a></sup> or other loans made directly to parents.</p><a id="select-another-taxonomy"></a>
      <p>Select a subgroup characteristic from the drop-down menu below to view relevant text and figures.</p>
      <div class="complex-label">
       <div class="taxonomy-static-wrap">
        <div class="taxonomy-static-label">
         Level of institution + Control of institution
        </div>
        <div class="plus-icon">
         +
        </div>
       </div><a id="tag-dropdown" style="position:relative; top: -75px"></a> <!-- Dropdown to select Taxonomy Item -->
       <div class="subgroup">
        <div class="dropdown dropdown--primary m-0">
         <a class="dropdown-toggle" role="button" id="subgroupMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span id="select-taxonomy-item-title">Time series </span> <span class="arrow"></span> </a>
         <div class="dropdown-menu" aria-labelledby="subgroupMenuButton" style="width: 100%;">
          <a class="dropdown-item d-none" id="all-available-findings" href="javascript:void();" onclick="selectTaxonomyItem(event, -1, null)">All available findings</a> <a data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="subgroup-chaacteristics-filter" style="" class="dropdown-item" href="javascript:void();" onclick="selectTaxonomyItem(event, 2, 'Time series')"><span style="overflow-wrap: break-word;word-wrap: break-word;-ms-word-break: break-all;word-break: break-all;word-break: break-word;-ms-hyphens: auto;-webkit-hyphens: auto;hyphens: auto;">Time series </span></a>
         </div>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="1" id="figure-1192">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 1 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#1"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#1" id="copy-clipboard-__fea87bf1871642cea9f90e2763403a4e" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1192, '1')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1192">
        <a id="1"></a>
        <figure>
         Figure 1. Percentage of first-time, full-time undergraduate students awarded financial aid at 4-year degree-granting postsecondary institutions, by control of institution: Academic years 2009–10, 2014–15, and 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div id="chart-__fea87bf1871642cea9f90e2763403a4e" style="width:100%;"></div>
          <div id="table-__fea87bf1871642cea9f90e2763403a4e" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__fea87bf1871642cea9f90e2763403a4e"></textarea>
            </div>
            <div>
             <button id="btn-copy-__fea87bf1871642cea9f90e2763403a4e" data-clipboard-target="#iframe-code-__fea87bf1871642cea9f90e2763403a4e">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents. Data through 2009–10 are for students receiving aid. Students were counted as receiving aid only if they were awarded and accepted aid and their aid was also disbursed. Beginning in 2010–11, data are for all students awarded aid. Although rounded numbers are displayed, the figures are based on unrounded data.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Spring 2011, Winter 2015–16, and Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>; and <i>Digest of Education Statistics 2016</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d16/tables/dt16_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__fea87bf1871642cea9f90e2763403a4e');

    (function ($) {
        let figureNumber = '1';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'true';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 0;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
        
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__fea87bf1871642cea9f90e2763403a4e';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"d39a7b71-0b07-494f-abcf-cd462728e8e9","label":"Total","key":"Total","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"78caf95c-aede-48ef-91c9-7c8778c981a2","label":"Public","key":"Public","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"b43cc58d-ecbc-4bfb-b867-18644e90a72f","label":"Private nonprofit","key":"Private nonprofit","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"5b4a92c3-9e5b-44c9-a135-eaf55c4758b9","label":"Private for-profit","key":"Private for-profit","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"2009\u201310","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"85.100314634316","value":85.100314634316,"placeholder":false,"valueRounded":85,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"85","displayValue_Table":"85","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"81.583866409863","value":81.583866409863,"placeholder":false,"valueRounded":82,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"82","displayValue_Table":"82","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"88.871808445657","value":88.871808445657,"placeholder":false,"valueRounded":89,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"89","displayValue_Table":"89","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"92.3047284448293","value":92.3047284448293,"placeholder":false,"valueRounded":92,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"92","displayValue_Table":"92","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"2014\u201315","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"85.59802516039919","value":85.59802516039919,"placeholder":false,"valueRounded":86,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"86","displayValue_Table":"86","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"83.5208245841474","value":83.5208245841474,"placeholder":false,"valueRounded":84,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"84","displayValue_Table":"84","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"89.5176547272698","value":89.5176547272698,"placeholder":false,"valueRounded":90,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"90","displayValue_Table":"90","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"89.300778814295","value":89.300778814295,"placeholder":false,"valueRounded":89,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"89","displayValue_Table":"89","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"2019\u201320","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"86.68710499379071","value":86.68710499379071,"placeholder":false,"valueRounded":87,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"87","displayValue_Table":"87","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"85.1496492416877","value":85.1496492416877,"placeholder":false,"valueRounded":85,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"85","displayValue_Table":"85","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"90.3147510331649","value":90.3147510331649,"placeholder":false,"valueRounded":90,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"90","displayValue_Table":"90","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"87.1321472529932","value":87.1321472529932,"placeholder":false,"valueRounded":87,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"87","displayValue_Table":"87","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Control of institution","categoriesTitleOuter":null,"seriesTitle":"Academic year","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Percent awarded aid",
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: false,
                tooltipRound: null,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: null
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__fea87bf1871642cea9f90e2763403a4e", function (ev) {
            $(wrap).find("#error-check-__fea87bf1871642cea9f90e2763403a4e").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__fea87bf1871642cea9f90e2763403a4e", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__fea87bf1871642cea9f90e2763403a4e").attr('data-on-src');
            var offSrc = $("#toggle-icon-__fea87bf1871642cea9f90e2763403a4e").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__fea87bf1871642cea9f90e2763403a4e").attr('src', onSrc);
            } else {
                $("#toggle-icon-__fea87bf1871642cea9f90e2763403a4e").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__fea87bf1871642cea9f90e2763403a4e").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__fea87bf1871642cea9f90e2763403a4e').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__fea87bf1871642cea9f90e2763403a4e').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__fea87bf1871642cea9f90e2763403a4e-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fea87bf1871642cea9f90e2763403a4e-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__fea87bf1871642cea9f90e2763403a4e').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__fea87bf1871642cea9f90e2763403a4e').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__fea87bf1871642cea9f90e2763403a4e-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__fea87bf1871642cea9f90e2763403a4e-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fea87bf1871642cea9f90e2763403a4e' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__fea87bf1871642cea9f90e2763403a4e').addClass('d-none');

            $('#chart-__fea87bf1871642cea9f90e2763403a4e-file').css('display', 'none');
            $('#chart-__fea87bf1871642cea9f90e2763403a4e').css('display', 'block');
            $('#table-__fea87bf1871642cea9f90e2763403a4e').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__fea87bf1871642cea9f90e2763403a4e');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__fea87bf1871642cea9f90e2763403a4e_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 60;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__fea87bf1871642cea9f90e2763403a4e-file').css('display', 'block');
                $('#chart-__fea87bf1871642cea9f90e2763403a4e').css('display', 'none');
                $('#table-__fea87bf1871642cea9f90e2763403a4e').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__fea87bf1871642cea9f90e2763403a4e-file').css('display', 'none');
                $('#chart-__fea87bf1871642cea9f90e2763403a4e').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__fea87bf1871642cea9f90e2763403a4e').css('display', 'block');
                $('#footnote-table-view-__fea87bf1871642cea9f90e2763403a4e').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__fea87bf1871642cea9f90e2763403a4e',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__fea87bf1871642cea9f90e2763403a4e',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__fea87bf1871642cea9f90e2763403a4e').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__fea87bf1871642cea9f90e2763403a4e').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__fea87bf1871642cea9f90e2763403a4e').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__fea87bf1871642cea9f90e2763403a4e').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1192');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '1';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents. Data through 2009–10 are for students receiving aid. Students were counted as receiving aid only if they were awarded and accepted aid and their aid was also disbursed. Beginning in 2010–11, data are for all students awarded aid. Although rounded numbers are displayed, the figures are based on unrounded data.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Spring 2011, Winter 2015–16, and Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>; and <i>Digest of Education Statistics 2016</i>, table <a href="https://nces.ed.gov/programs/digest/d16/tables/dt16_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 1. Percentage of first-time, full-time undergraduate students awarded financial aid at 4-year degree-granting postsecondary institutions, by control of institution: Academic years 2009&#x2013;10, 2014&#x2013;15, and 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    ''
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-1.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="1" data-c-id="1452" data-figure-number="1" data-c-seq="3" class="component-paragraph" id="component-1452">
       <div>
        At 4-year degree-granting postsecondary institutions overall, the percentage of first-time, full-time degree/certificate-seeking undergraduate students awarded financial aid increased from 85 to 87 percent between academic years 2009–10 and 2019–20.<sup><a href="#fn2" name="fr2">2</a></sup> However, changes differed by control of institution (i.e., public, private nonprofit, and private for-profit). Between 2009–10 and 2019–20, the percentages of students awarded aid increased at public institutions (from 82 to 85 percent) and at private nonprofit institutions (from 89 to 90 percent). In contrast, the percentage decreased from 92 to 87 percent at private for-profit institutions over the same period. <span class="d-none" data-component-id="1452" data-show-figure="true" data-figure-number="1" data-figure-id="1192" data-taxonomy-id="2">[Time series ]</span>
       </div>
       <div id="component-1452-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1452"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1452">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1452">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="2" id="figure-1193">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 2 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#2"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#2" id="copy-clipboard-__ac1ee43ebc9d4d6784d10a9bb2c11c31" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1193, '2')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1193">
        <a id="2"></a>
        <figure>
         Figure 2. Percentage of first-time, full-time undergraduate students awarded financial aid at 2-year degree-granting postsecondary institutions, by control of institution: Academic years 2009–10, 2014–15, and 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div id="chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31" style="width:100%;"></div>
          <div id="table-__ac1ee43ebc9d4d6784d10a9bb2c11c31" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__ac1ee43ebc9d4d6784d10a9bb2c11c31"></textarea>
            </div>
            <div>
             <button id="btn-copy-__ac1ee43ebc9d4d6784d10a9bb2c11c31" data-clipboard-target="#iframe-code-__ac1ee43ebc9d4d6784d10a9bb2c11c31">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents. Data through 2009–10 are for students receiving aid. Students were counted as receiving aid only if they were awarded and accepted aid and their aid was also disbursed. Beginning in 2010–11, data are for all students awarded aid. Although rounded numbers are displayed, the figures are based on unrounded data.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Spring 2011, Winter 2015–16, and Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>; and <i>Digest of Education Statistics 2016</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d16/tables/dt16_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__ac1ee43ebc9d4d6784d10a9bb2c11c31');

    (function ($) {
        let figureNumber = '2';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'true';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 0;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
        
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"e41f8960-d4dc-4573-a5c3-54705f3a376d","label":"Total","key":"Total","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"3a37456c-cdd3-4216-b11f-20d6be7e7631","label":"Public","key":"Public","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"ab1ecd34-cd81-407f-9150-fe9c6ce192f0","label":"Private nonprofit","key":"Private nonprofit","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"84c6b71e-9ea7-404f-be70-b18e1db0dc6b","label":"Private for-profit","key":"Private for-profit","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"2009\u201310","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"75.46644950016297","value":75.46644950016297,"placeholder":false,"valueRounded":75,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"75","displayValue_Table":"75","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"70.2598178365021","value":70.2598178365021,"placeholder":false,"valueRounded":70,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"70","displayValue_Table":"70","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"89.3724596014672","value":89.3724596014672,"placeholder":false,"valueRounded":89,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"89","displayValue_Table":"89","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"88.2594998376096","value":88.2594998376096,"placeholder":false,"valueRounded":88,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"88","displayValue_Table":"88","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"2014\u201315","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"78.83246706382117","value":78.83246706382117,"placeholder":false,"valueRounded":79,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"79","displayValue_Table":"79","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"76.7499822305455","value":76.7499822305455,"placeholder":false,"valueRounded":77,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"77","displayValue_Table":"77","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"90.6693325716462","value":90.6693325716462,"placeholder":false,"valueRounded":91,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"91","displayValue_Table":"91","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"87.606437559632","value":87.606437559632,"placeholder":false,"valueRounded":88,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"88","displayValue_Table":"88","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"2019\u201320","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"81.92021628152486","value":81.92021628152486,"placeholder":false,"valueRounded":82,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"82","displayValue_Table":"82","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"80.5645122522269","value":80.5645122522269,"placeholder":false,"valueRounded":81,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"81","displayValue_Table":"81","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"93.6405767250258","value":93.6405767250258,"placeholder":false,"valueRounded":94,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"94","displayValue_Table":"94","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"88.2471141980365","value":88.2471141980365,"placeholder":false,"valueRounded":88,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"88","displayValue_Table":"88","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Control of institution","categoriesTitleOuter":"1","seriesTitle":"Academic year","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Percent awarded aid",
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: false,
                tooltipRound: null,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: null
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__ac1ee43ebc9d4d6784d10a9bb2c11c31", function (ev) {
            $(wrap).find("#error-check-__ac1ee43ebc9d4d6784d10a9bb2c11c31").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__ac1ee43ebc9d4d6784d10a9bb2c11c31", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__ac1ee43ebc9d4d6784d10a9bb2c11c31").attr('data-on-src');
            var offSrc = $("#toggle-icon-__ac1ee43ebc9d4d6784d10a9bb2c11c31").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__ac1ee43ebc9d4d6784d10a9bb2c11c31").attr('src', onSrc);
            } else {
                $("#toggle-icon-__ac1ee43ebc9d4d6784d10a9bb2c11c31").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__ac1ee43ebc9d4d6784d10a9bb2c11c31").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__ac1ee43ebc9d4d6784d10a9bb2c11c31').addClass('d-none');

            $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31-file').css('display', 'none');
            $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'block');
            $('#table-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 60;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31-file').css('display', 'block');
                $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'none');
                $('#table-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31-file').css('display', 'none');
                $('#chart-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__ac1ee43ebc9d4d6784d10a9bb2c11c31').css('display', 'block');
                $('#footnote-table-view-__ac1ee43ebc9d4d6784d10a9bb2c11c31').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__ac1ee43ebc9d4d6784d10a9bb2c11c31',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__ac1ee43ebc9d4d6784d10a9bb2c11c31',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__ac1ee43ebc9d4d6784d10a9bb2c11c31').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1193');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '2';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents. Data through 2009–10 are for students receiving aid. Students were counted as receiving aid only if they were awarded and accepted aid and their aid was also disbursed. Beginning in 2010–11, data are for all students awarded aid. Although rounded numbers are displayed, the figures are based on unrounded data.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Spring 2011, Winter 2015–16, and Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>; and <i>Digest of Education Statistics 2016</i>, table <a href="https://nces.ed.gov/programs/digest/d16/tables/dt16_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 2. Percentage of first-time, full-time undergraduate students awarded financial aid at 2-year degree-granting postsecondary institutions, by control of institution: Academic years 2009&#x2013;10, 2014&#x2013;15, and 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    ''
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-2.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="2" data-c-id="1453" data-figure-number="2" data-c-seq="4" class="component-paragraph" id="component-1453">
       <div>
        At 2-year degree-granting postsecondary institutions overall, the percentage of first-time, full-time degree/certificate-seeking undergraduate students awarded financial aid increased from 75 to 82 percent between academic years 2009–10 and 2019–20. The percentages also increased at public institutions (from 70 to 81 percent) and at private nonprofit institutions (from 89 to 94 percent). In contrast, the percentage of students awarded aid at private for-profit institutions was 88 percent in both 2009–10 and 2019–20, fluctuating between 84 and 91 percent in the intervening years. <span class="d-none" data-component-id="1453" data-show-figure="true" data-figure-number="2" data-figure-id="1193" data-taxonomy-id="2">[Time series ]</span>
       </div>
       <div id="component-1453-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1453"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1453">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1453">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="3" id="figure-1194">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 3 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#3"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#3" id="copy-clipboard-__fdc8ec3031264574b483f732865f9470" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1194, '3')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1194">
        <a id="3"></a>
        <figure>
         Figure 3. Percentage of first-time, full-time undergraduate students awarded financial aid at 4-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div id="chart-__fdc8ec3031264574b483f732865f9470" style="width:100%;"></div>
          <div id="table-__fdc8ec3031264574b483f732865f9470" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__fdc8ec3031264574b483f732865f9470"></textarea>
            </div>
            <div>
             <button id="btn-copy-__fdc8ec3031264574b483f732865f9470" data-clipboard-target="#iframe-code-__fdc8ec3031264574b483f732865f9470">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup>1 </sup> Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.</p>
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__fdc8ec3031264574b483f732865f9470');

    (function ($) {
        let figureNumber = '3';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'true';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 0;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
        
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__fdc8ec3031264574b483f732865f9470';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"5f6accc7-72e6-4895-92c9-dc193059c3c7","label":"Federal grants","key":"Federal grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"76998a2f-4bd6-49b0-80d9-a78f337b73d7","label":"State/local grants","key":"State/local grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"0b2f0f4c-b254-4264-987a-42dd436b5a76","label":"Institutional grants","key":"Institutional grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"c238b773-4e32-4d30-bc48-b17ebc73205d","label":"Student loans^1^","key":"Student loans^1^","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"Public","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"48.8133468202605","value":48.8133468202605,"placeholder":false,"valueRounded":49,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"49","displayValue_Table":"49","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"38.3645791391281","value":38.3645791391281,"placeholder":false,"valueRounded":38,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"38","displayValue_Table":"38","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"52.6998405792832","value":52.6998405792832,"placeholder":false,"valueRounded":53,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"53","displayValue_Table":"53","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"41.738847915255","value":41.738847915255,"placeholder":false,"valueRounded":42,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"42","displayValue_Table":"42","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private nonprofit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"42.6911770745932","value":42.6911770745932,"placeholder":false,"valueRounded":43,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"43","displayValue_Table":"43","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"24.8481790284631","value":24.8481790284631,"placeholder":false,"valueRounded":25,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"25","displayValue_Table":"25","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"83.5966852665693","value":83.5966852665693,"placeholder":false,"valueRounded":84,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"84","displayValue_Table":"84","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"55.7713483266933","value":55.7713483266933,"placeholder":false,"valueRounded":56,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"56","displayValue_Table":"56","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private for-profit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"69.2253179665063","value":69.2253179665063,"placeholder":false,"valueRounded":69,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"69","displayValue_Table":"69","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"9.63224049830293","value":9.63224049830293,"placeholder":false,"valueRounded":10,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"10","displayValue_Table":"10","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"36.140017157137","value":36.140017157137,"placeholder":false,"valueRounded":36,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"36","displayValue_Table":"36","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"67.8191786953116","value":67.8191786953116,"placeholder":false,"valueRounded":68,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"68","displayValue_Table":"68","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Type of aid","categoriesTitleOuter":null,"seriesTitle":"Control of institution","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Percent awarded aid",
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: false,
                tooltipRound: null,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: null
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__fdc8ec3031264574b483f732865f9470", function (ev) {
            $(wrap).find("#error-check-__fdc8ec3031264574b483f732865f9470").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__fdc8ec3031264574b483f732865f9470", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__fdc8ec3031264574b483f732865f9470").attr('data-on-src');
            var offSrc = $("#toggle-icon-__fdc8ec3031264574b483f732865f9470").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__fdc8ec3031264574b483f732865f9470").attr('src', onSrc);
            } else {
                $("#toggle-icon-__fdc8ec3031264574b483f732865f9470").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__fdc8ec3031264574b483f732865f9470").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__fdc8ec3031264574b483f732865f9470').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__fdc8ec3031264574b483f732865f9470').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__fdc8ec3031264574b483f732865f9470-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__fdc8ec3031264574b483f732865f9470-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__fdc8ec3031264574b483f732865f9470').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__fdc8ec3031264574b483f732865f9470').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__fdc8ec3031264574b483f732865f9470-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__fdc8ec3031264574b483f732865f9470-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__fdc8ec3031264574b483f732865f9470' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__fdc8ec3031264574b483f732865f9470' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__fdc8ec3031264574b483f732865f9470').addClass('d-none');

            $('#chart-__fdc8ec3031264574b483f732865f9470-file').css('display', 'none');
            $('#chart-__fdc8ec3031264574b483f732865f9470').css('display', 'block');
            $('#table-__fdc8ec3031264574b483f732865f9470').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__fdc8ec3031264574b483f732865f9470');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__fdc8ec3031264574b483f732865f9470_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 60;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__fdc8ec3031264574b483f732865f9470-file').css('display', 'block');
                $('#chart-__fdc8ec3031264574b483f732865f9470').css('display', 'none');
                $('#table-__fdc8ec3031264574b483f732865f9470').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__fdc8ec3031264574b483f732865f9470-file').css('display', 'none');
                $('#chart-__fdc8ec3031264574b483f732865f9470').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__fdc8ec3031264574b483f732865f9470').css('display', 'block');
                $('#footnote-table-view-__fdc8ec3031264574b483f732865f9470').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__fdc8ec3031264574b483f732865f9470',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__fdc8ec3031264574b483f732865f9470',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__fdc8ec3031264574b483f732865f9470').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__fdc8ec3031264574b483f732865f9470').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__fdc8ec3031264574b483f732865f9470').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__fdc8ec3031264574b483f732865f9470').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1194');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '3';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '1', content: 'Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.' }); footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 3. Percentage of first-time, full-time undergraduate students awarded financial aid at 4-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    ''
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-3.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="3" data-c-id="1454" data-figure-number="3" data-c-seq="5" class="component-paragraph" id="component-1454">
       <div>
        The percentage of first-time, full-time degree/certificate-seeking undergraduate students at 4-year institutions who were awarded specific types of financial aid varied by control of institution. In academic year 2019–20, each control type awarded the highest percentage of students in at least one type of aid and awarded the lowest percentage of students in another type of aid. The percentages of students awarded federal grants (69 percent) and student loans (68 percent) were highest at private for-profit institutions. The percentage awarded state or local grants (38 percent) was highest at public institutions. The percentage awarded institutional grants (84 percent) was highest at private nonprofit institutions.
       </div>
       <div id="component-1454-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1454"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1454">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1454">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="4" id="figure-1195">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 4 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#4"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#4" id="copy-clipboard-__32a6ad839c2647b691931aeb25b0fbeb" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1195, '4')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1195">
        <a id="4"></a>
        <figure>
         Figure 4. Percentage of first-time, full-time undergraduate students awarded financial aid at 2-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div id="chart-__32a6ad839c2647b691931aeb25b0fbeb" style="width:100%;"></div>
          <div id="table-__32a6ad839c2647b691931aeb25b0fbeb" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__32a6ad839c2647b691931aeb25b0fbeb"></textarea>
            </div>
            <div>
             <button id="btn-copy-__32a6ad839c2647b691931aeb25b0fbeb" data-clipboard-target="#iframe-code-__32a6ad839c2647b691931aeb25b0fbeb">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup>1</sup> Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.</p>
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Although rounded numbers are displayed, the figures are based on unrounded data.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__32a6ad839c2647b691931aeb25b0fbeb');

    (function ($) {
        let figureNumber = '4';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'true';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 0;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
        
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__32a6ad839c2647b691931aeb25b0fbeb';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"94bc54a5-51ea-4d0d-acd4-5f88df0c5684","label":"Federal grants","key":"Federal grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"e57835a9-a52a-4402-9f57-7c5403548d56","label":"State/local grants","key":"State/local grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"ab3ff3e4-edac-4303-8b90-69cfd000d5bf","label":"Institutional grants","key":"Institutional grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"c9f26dca-e64e-4e94-85f3-2de460d6bbc9","label":"Student loans^1^","key":"Student loans^1^","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"Public","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"60.0108964075684","value":60.0108964075684,"placeholder":false,"valueRounded":60,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"60","displayValue_Table":"60","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"45.5147573323743","value":45.5147573323743,"placeholder":false,"valueRounded":46,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"46","displayValue_Table":"46","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"17.6641093344111","value":17.6641093344111,"placeholder":false,"valueRounded":18,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"18","displayValue_Table":"18","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"17.1785782324674","value":17.1785782324674,"placeholder":false,"valueRounded":17,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"17","displayValue_Table":"17","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private nonprofit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"84.7772914521112","value":84.7772914521112,"placeholder":false,"valueRounded":85,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"85","displayValue_Table":"85","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"10.1763645726056","value":10.1763645726056,"placeholder":false,"valueRounded":10,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"10","displayValue_Table":"10","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"19.1683831101957","value":19.1683831101957,"placeholder":false,"valueRounded":19,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"19","displayValue_Table":"19","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"78.2183316168898","value":78.2183316168898,"placeholder":false,"valueRounded":78,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"78","displayValue_Table":"78","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private for-profit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"77.356965785364","value":77.356965785364,"placeholder":false,"valueRounded":77,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"77","displayValue_Table":"77","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"6.07629219495681","value":6.07629219495681,"placeholder":false,"valueRounded":6,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"6","displayValue_Table":"6","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"17.0450698380456","value":17.0450698380456,"placeholder":false,"valueRounded":17,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"17","displayValue_Table":"17","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"76.4155991656565","value":76.4155991656565,"placeholder":false,"valueRounded":76,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"76","displayValue_Table":"76","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Type of aid","categoriesTitleOuter":null,"seriesTitle":"Control of institution","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Percent awarded aid",
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: false,
                tooltipRound: null,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: null
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__32a6ad839c2647b691931aeb25b0fbeb", function (ev) {
            $(wrap).find("#error-check-__32a6ad839c2647b691931aeb25b0fbeb").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__32a6ad839c2647b691931aeb25b0fbeb", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__32a6ad839c2647b691931aeb25b0fbeb").attr('data-on-src');
            var offSrc = $("#toggle-icon-__32a6ad839c2647b691931aeb25b0fbeb").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__32a6ad839c2647b691931aeb25b0fbeb").attr('src', onSrc);
            } else {
                $("#toggle-icon-__32a6ad839c2647b691931aeb25b0fbeb").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__32a6ad839c2647b691931aeb25b0fbeb").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__32a6ad839c2647b691931aeb25b0fbeb' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__32a6ad839c2647b691931aeb25b0fbeb').addClass('d-none');

            $('#chart-__32a6ad839c2647b691931aeb25b0fbeb-file').css('display', 'none');
            $('#chart-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'block');
            $('#table-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__32a6ad839c2647b691931aeb25b0fbeb');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__32a6ad839c2647b691931aeb25b0fbeb_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 40;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 40;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 60;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 270;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__32a6ad839c2647b691931aeb25b0fbeb-file').css('display', 'block');
                $('#chart-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'none');
                $('#table-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__32a6ad839c2647b691931aeb25b0fbeb-file').css('display', 'none');
                $('#chart-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__32a6ad839c2647b691931aeb25b0fbeb').css('display', 'block');
                $('#footnote-table-view-__32a6ad839c2647b691931aeb25b0fbeb').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__32a6ad839c2647b691931aeb25b0fbeb',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__32a6ad839c2647b691931aeb25b0fbeb',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__32a6ad839c2647b691931aeb25b0fbeb').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__32a6ad839c2647b691931aeb25b0fbeb').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__32a6ad839c2647b691931aeb25b0fbeb').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__32a6ad839c2647b691931aeb25b0fbeb').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1195');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '4';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '1', content: 'Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.' }); footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Although rounded numbers are displayed, the figures are based on unrounded data.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 4. Percentage of first-time, full-time undergraduate students awarded financial aid at 2-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    ''
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-4.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="4" data-c-id="1455" data-figure-number="4" data-c-seq="6" class="component-paragraph" id="component-1455">
       <div>
        The percentage of first-time, full-time degree/certificate-seeking undergraduate students at 2-year institutions who were awarded specific types of financial aid also varied by control of institution. In academic year 2019–20, the percentage of students awarded federal grants was higher at private nonprofit institutions (85 percent) than at private for-profit institutions (77 percent) and public institutions (60 percent). A similar pattern was observed for student loans. The percentage of students awarded student loans was higher at private nonprofit institutions (78 percent) than at private for-profit institutions (76 percent) and public institutions (17 percent). In contrast, the percentage of students awarded state or local grants was more than four times higher at public institutions (46 percent) than at private nonprofit institutions (10 percent) and private for-profit institutions (6 percent). Meanwhile, the percentage of students awarded institutional grants differed by less than 3 percentage points across controls, from a high of 19 percent at private nonprofit institutions to a low of 17 percent at private for-profit institutions.
       </div>
       <div id="component-1455-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1455"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1455">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1455">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="5" id="figure-1196">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 5 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#5"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#5" id="copy-clipboard-__56d68b0a0a8b449bb98e4ad9b50dd148" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1196, '5')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1196">
        <a id="5"></a>
        <figure>
         Figure 5. Average amount of financial aid awarded to first-time, full-time undergraduate students at 4-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div class="text-center mb-2">
           [in constant 2020–21 dollars]
          </div>
          <div id="chart-__56d68b0a0a8b449bb98e4ad9b50dd148" style="width:100%;"></div>
          <div id="table-__56d68b0a0a8b449bb98e4ad9b50dd148" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__56d68b0a0a8b449bb98e4ad9b50dd148"></textarea>
            </div>
            <div>
             <button id="btn-copy-__56d68b0a0a8b449bb98e4ad9b50dd148" data-clipboard-target="#iframe-code-__56d68b0a0a8b449bb98e4ad9b50dd148">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup>1</sup> Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.</p>
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Award amounts are in constant 2020–21 dollars, based on the Consumer Price Index (CPI). Averages exclude students who were not awarded financial aid. Although rounded numbers are displayed, the figures are based on unrounded data.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__56d68b0a0a8b449bb98e4ad9b50dd148');

    (function ($) {
        let figureNumber = '5';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'false';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 0;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
ticksNumber = 10;         
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__56d68b0a0a8b449bb98e4ad9b50dd148';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"7c480b90-f102-48d6-8129-960187f6697f","label":"Federal grants","key":"Federal grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"f4823889-4435-4a65-9b4e-9e498c7c0024","label":"State/local grants","key":"State/local grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"3ee0dca4-c09f-472e-9de6-72ca74f2c889","label":"Institutional grants","key":"Institutional grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"77bd8343-f9a4-4429-b818-c3fda5d46759","label":"Student loans^1^","key":"Student loans^1^","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"Public","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4548.59685947931","value":4548.59685947931,"placeholder":false,"valueRounded":4549,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$4,500","displayValue_Table":"$4,549","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4639.53204162711","value":4639.53204162711,"placeholder":false,"valueRounded":4640,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$4,600","displayValue_Table":"$4,640","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"6492.77536594668","value":6492.77536594668,"placeholder":false,"valueRounded":6493,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$6,500","displayValue_Table":"$6,493","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"7375.26718246902","value":7375.26718246902,"placeholder":false,"valueRounded":7375,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$7,400","displayValue_Table":"$7,375","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private nonprofit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4615.66220059587","value":4615.66220059587,"placeholder":false,"valueRounded":4616,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$4,600","displayValue_Table":"$4,616","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4710.38437501781","value":4710.38437501781,"placeholder":false,"valueRounded":4710,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$4,700","displayValue_Table":"$4,710","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"23229.7651321843","value":23229.7651321843,"placeholder":false,"valueRounded":23230,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$23,200","displayValue_Table":"$23,230","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"8738.87414708726","value":8738.87414708726,"placeholder":false,"valueRounded":8739,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$8,700","displayValue_Table":"$8,739","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private for-profit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4966.98654872496","value":4966.98654872496,"placeholder":false,"valueRounded":4967,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$5,000","displayValue_Table":"$4,967","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"3801.61897003293","value":3801.61897003293,"placeholder":false,"valueRounded":3802,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$3,800","displayValue_Table":"$3,802","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"6351.34494023759","value":6351.34494023759,"placeholder":false,"valueRounded":6351,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$6,400","displayValue_Table":"$6,351","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"8207.25653766612","value":8207.25653766612,"placeholder":false,"valueRounded":8207,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"$8,200","displayValue_Table":"$8,207","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Type of aid","categoriesTitleOuter":null,"seriesTitle":"Control of institution","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Average amount of aid",
                addDollarToTop: true,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: true,
                tooltipRound: 100,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: 0
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__56d68b0a0a8b449bb98e4ad9b50dd148", function (ev) {
            $(wrap).find("#error-check-__56d68b0a0a8b449bb98e4ad9b50dd148").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__56d68b0a0a8b449bb98e4ad9b50dd148", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__56d68b0a0a8b449bb98e4ad9b50dd148").attr('data-on-src');
            var offSrc = $("#toggle-icon-__56d68b0a0a8b449bb98e4ad9b50dd148").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__56d68b0a0a8b449bb98e4ad9b50dd148").attr('src', onSrc);
            } else {
                $("#toggle-icon-__56d68b0a0a8b449bb98e4ad9b50dd148").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__56d68b0a0a8b449bb98e4ad9b50dd148").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__56d68b0a0a8b449bb98e4ad9b50dd148').addClass('d-none');

            $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148-file').css('display', 'none');
            $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'block');
            $('#table-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 50;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__56d68b0a0a8b449bb98e4ad9b50dd148_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 50;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 50;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 50;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 50;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148-file').css('display', 'block');
                $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'none');
                $('#table-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148-file').css('display', 'none');
                $('#chart-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__56d68b0a0a8b449bb98e4ad9b50dd148').css('display', 'block');
                $('#footnote-table-view-__56d68b0a0a8b449bb98e4ad9b50dd148').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__56d68b0a0a8b449bb98e4ad9b50dd148',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__56d68b0a0a8b449bb98e4ad9b50dd148',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__56d68b0a0a8b449bb98e4ad9b50dd148').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__56d68b0a0a8b449bb98e4ad9b50dd148').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1196');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '5';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '1', content: 'Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.' }); footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Award amounts are in constant 2020–21 dollars, based on the Consumer Price Index (CPI). Averages exclude students who were not awarded financial aid. Although rounded numbers are displayed, the figures are based on unrounded data.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 5. Average amount of financial aid awarded to first-time, full-time undergraduate students at 4-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    '[in constant 2020&#x2013;21 dollars]'
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-5.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="5" data-c-id="1456" data-figure-number="5" data-c-seq="7" class="component-paragraph" id="component-1456">
       <div>
        The average amount of financial aid awarded to first-time, full-time degree-seeking undergraduates varied by control, particularly for institutional grants. Across 4-year institutions in academic year 2019–20, the average federal grant award ranged from $4,500 at public institutions to $5,000 at private for-profit institutions (reported in constant 2020–21 dollars). The average state or local grant award ranged from $3,800 at private for-profit institutions to $4,700 at private nonprofit institutions. There were larger differences by control of institution in average institutional grant awards. The average institutional grant award at private nonprofit institutions ($23,200) was more than three times higher than at public institutions ($6,500) and private for-profit institutions ($6,400), which reflects a higher average total cost of attendance at private nonprofit institutions (see indicator <a href="https://nces.ed.gov/programs/coe/indicator/cua">Price of Attending an Undergraduate Institution</a>). Average student loan amounts were higher at private nonprofit institutions ($8,700) and private for-profit institutions ($8,200) than at public institutions ($7,400).
       </div>
       <div id="component-1456-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1456"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1456">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1456">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div>
      <div class="chart" data-figure="6" id="figure-1197">
       <div class="share">
        <div class="share-button-wrap">
         <img src="/programs/coe/images/share-button.svg" alt="">
        </div>
        <div class="share-options">
         <ul class="d-flex flex-column">
          <li>
           <div data-sharer="facebook" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="facebook" src="/programs/coe/images/share-facebook.svg" data-image-hover="/programs/coe/images/share-facebook-hover.svg" alt="Share this indicator figure on Facebook" title="Share this indicator figure on Facebook">
           </div></li>
          <li>
           <div data-sharer="twitter" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="twitter" src="/programs/coe/images/share-twitter.svg" data-image-hover="/programs/coe/images/share-twitter-hover.svg" alt="Share this indicator figure on Twitter" title="Share this indicator figure on Twitter">
           </div></li>
          <li>
           <div data-sharer="linkedin" data-url="http://nces.ed.gov/programs/coe/indicator/cuc">
            <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="linkedin" src="/programs/coe/images/linkedin-share.svg" data-image-hover="/programs/coe/images/linkedin-share-hover.svg" alt="Share this indicator figure on LinkedIn" title="Share this indicator figure on LinkedIn">
           </div></li>
          <li><a href="mailto:?subject=Condition of Education: Figure 6 from Indicator CUC&amp;body=http://nces.ed.gov/programs/coe/indicator/cuc#6"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="email" src="/programs/coe/images/share-connect-with-us.svg" data-image-hover="/programs/coe/images/share-connect-with-us-hover.svg" alt="Share this indicator figure via email" title="Share this indicator figure via email"> </a></li>
          <li>
           <div class="clipboard-confirmation" style="display: none;z-index:1000;">
            <span>URL Copied</span>
           </div><img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="share-url" onclick="shareLinkClicked(event)" alt="Click to copy URL of this page into clipboard" title="Click to copy URL of this page into clipboard" data-clipboard-text="http://nces.ed.gov/programs/coe/indicator/cuc#6" id="copy-clipboard-__d709dfbabbe1486695ea8eb4e19fdd13" src="/programs/coe/images/share-link.svg" data-image-hover="/programs/coe/images/share-link-hover.svg"></li>
          <li><a href="#" class="link-embed"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="embed" src="/programs/coe/images/embed-link.svg" data-image-hover="/programs/coe/images/embed-link-hover.svg" alt="Embed this figure" title="Embed this figure"> </a></li>
          <li class="share-download-figure"><a href="javascript: downloadFigure(1197, '6')"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-figure" src="/programs/coe/images/figure-image-link.svg" data-image-hover="/programs/coe/images/figure-image-link-hover.svg" alt="Download this indicator figure" title="Download this indicator figure"> </a></li>
          <li><a href="#" class="link-download-data"> <img data-ev data-ev-n="click" data-ev-c="figure-share" data-ev-l="download-data" src="/programs/coe/images/table-cells-link.svg" data-image-hover="/programs/coe/images/table-cells-link-hover.svg" alt="Download data for this indicator figure" title="Download data for this indicator figure"> </a></li>
         </ul>
        </div>
       </div>
       <div class="container-figure" id="download-container-figure-1197">
        <a id="6"></a>
        <figure>
         Figure 6. Average amount of financial aid awarded to first-time, full-time undergraduate students at 2-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019–20
        </figure>
        <div class="wrap d-flex" style="width: 100%;overflow: hidden; position: relative;">
         <div class="interact-wrapper d-none" onclick="removeChartInteractiveContainer(event)">
          <div class="interact">
           <img src="/programs/coe/images/chart-interact.svg" style="width: 70px;">
           <div class="mt-3">
            Hover, click, and tap to see more for all figures on this page.
           </div>
          </div>
         </div>
         <div class="options-container">
          <div class="d-flex flex-column h-100">
           <div class="flex-grow-1 options-container-body"></div>
           <div class="options-container-footer">
            <div class="d-flex">
             <div class="flex-grow-1 position-relative">
              <img src="/programs/coe/images/circle-info.svg">
              <div class="tooltip-variables">
               Users can select any combination of available years and categories in any figure format (i.e., bar or table). The initial selection of years and categories may not be optimal in different views.
              </div>
             </div>
             <div>
              <a href="#">CLOSE</a>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div style="background-color: #fff;padding: 8px 8px;" class="flex-grow-1">
          <div class="tools">
           <div style="width: 120px;">
            <button class="modify" data-ev data-ev-n="click" data-ev-c="indicator" data-ev-l="modify-chart">Modify figure</button>
           </div>
           <div class="switch-view">
            <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="bar-view" class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span data-ev data-ev-n="click" data-ev-c="indicator-chart" data-ev-l="table-view" class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
           </div>
           <div style="width: 160px" class="confidence-interval">
           </div>
          </div>
          <div class="switch-view-mobile">
           <span class="chart-view-toggle active" data-type="bar" style="cursor: pointer">Bar</span> <span class="separator">|</span> <span class="chart-view-toggle" data-type="table" style="cursor: pointer">Table</span>
          </div>
          <div class="text-center mb-2">
           [in constant 2020–21 dollars]
          </div>
          <div id="chart-__d709dfbabbe1486695ea8eb4e19fdd13" style="width:100%;"></div>
          <div id="table-__d709dfbabbe1486695ea8eb4e19fdd13" style="width:100%; display: none;"></div>
          <div class="years-interval-message">
           Users can select years at irregular&nbsp;intervals. However, as a result, the distance between the data points will not be proportional to the number of years between them.
          </div>
          <div class="legends"></div>
         </div>
         <div class="embed-wrapper d-none">
          <div class="embed-container">
           <div class="float-right close">
            X
           </div>
           <h6>Embed this figure</h6>
           <div class="d-flex">
            <div class="flex-grow-1 mr-1">
             <textarea id="iframe-code-__d709dfbabbe1486695ea8eb4e19fdd13"></textarea>
            </div>
            <div>
             <button id="btn-copy-__d709dfbabbe1486695ea8eb4e19fdd13" data-clipboard-target="#iframe-code-__d709dfbabbe1486695ea8eb4e19fdd13">Copy</button>
            </div>
           </div>
          </div>
         </div>
        </div>
        <div class="figure-footnotes">
         <p><sup>1</sup> Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.</p>
         <p><sup></sup>NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate's or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Award amounts are in constant 2020–21 dollars, based on the Consumer Price Index (CPI). Averages exclude students who were not awarded financial aid.</p>
         <p><sup></sup> SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a data-ev data-ev-n="click" data-ev-c="figure-footnote" data-ev-l="table-view" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.</p>
        </div>
       </div>
      </div>
      <script>
    new ClipboardJS('#copy-clipboard-__d709dfbabbe1486695ea8eb4e19fdd13');

    (function ($) {
        let figureNumber = '6';
        let chartView = 'bar'; // default chart view, coming from DB
        let chartDirection = 'vertical';
        let hasLineView = false; // from db
        let hasBarView = true; // from db

        // Extract data from FigureTemplate
        let chartType = 'onelevelgroupeddata'; // from db
        let xAxisSkip = null;
        let isPercentage = 'true' === 'false';
        let formatMillions = 'true' === 'false';
        let formatBillions = 'true' === 'false';
        let maxScale = 24000;        
        let ticksNumber = 10;
        if (maxScale && maxScale < 100)
            ticksNumber = 5;
ticksNumber = 10;         
        const projectionYear = null;

        // div that contains chart svg
        const element = '#chart-__d709dfbabbe1486695ea8eb4e19fdd13';
        const wrap = $(element).closest(".chart");
        let figureData = JSON.parse('{"years":null,"groupTitle":"Lorem ipsum","variables":null,"key":null,"visible":true,"categories":[{"id":"b4487094-5363-4103-8d2e-5bddf1e5e8bf","label":"Federal grants","key":"Federal grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"07e9aaef-b268-417e-9a7d-ccdb6ac59885","label":"State/local grants","key":"State/local grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"0bc7a8b7-04a9-4d7b-8925-481ec5d559ba","label":"Institutional grants","key":"Institutional grants","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null},{"id":"12a96980-2f83-4def-85fa-276abb5c15e7","label":"Student loans^1^","key":"Student loans^1^","visible":true,"header":false,"dataAsHeader":false,"noMove":false,"varName":null}],"series":[{"key":"Public","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4951.26828672005","value":4951.26828672005,"placeholder":false,"valueRounded":4951,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"5,000","displayValue_Table":"4,951","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"2330.57340484915","value":2330.57340484915,"placeholder":false,"valueRounded":2331,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"2,300","displayValue_Table":"2,331","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"2135.82061869919","value":2135.82061869919,"placeholder":false,"valueRounded":2136,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"2,100","displayValue_Table":"2,136","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4804.19616751456","value":4804.19616751456,"placeholder":false,"valueRounded":4804,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"4,800","displayValue_Table":"4,804","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private nonprofit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"5858.18634845737","value":5858.18634845737,"placeholder":false,"valueRounded":5858,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"5,900","displayValue_Table":"5,858","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"3865.17763776456","value":3865.17763776456,"placeholder":false,"valueRounded":3865,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"3,900","displayValue_Table":"3,865","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"8065.55408550296","value":8065.55408550296,"placeholder":false,"valueRounded":8066,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"8,100","displayValue_Table":"8,066","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"6507.86237770754","value":6507.86237770754,"placeholder":false,"valueRounded":6508,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"6,500","displayValue_Table":"6,508","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]},{"key":"Private for-profit","visible":true,"values":[{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"4728.16613020825","value":4728.16613020825,"placeholder":false,"valueRounded":4728,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"4,700","displayValue_Table":"4,728","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"2774.81689873456","value":2774.81689873456,"placeholder":false,"valueRounded":2775,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"2,800","displayValue_Table":"2,775","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"1584.70939608514","value":1584.70939608514,"placeholder":false,"valueRounded":1585,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"1,600","displayValue_Table":"1,585","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"},{"displayPrefix":null,"displayPostfix":null,"stateName":null,"locationType":null,"variableName":null,"state":null,"valueRaw":"7791.62162462972","value":7791.62162462972,"placeholder":false,"valueRounded":7792,"valueSeRaw":null,"valueSe":null,"valueSeNotRounded":null,"errorTopBottom":null,"roundValue":true,"displayValue":"7,800","displayValue_Table":"7,792","displayErrorTopBottom":"\u0026dagger;","displayValueSe":"\u0026dagger;"}]}],"categoriesTitle":"Type of aid","categoriesTitleOuter":null,"seriesTitle":"Control of institution","hasAnySe":false,"isSingleSerieWithTotalCategory":false,"hasUnitedStatesAndOECD":false,"noData":false}');
        let twoLevelFigureData = JSON.parse('null');

        let seriesTitle = '';
        if (figureData) {
            seriesTitle = figureData.seriesTitle;
        }
        if (twoLevelFigureData && twoLevelFigureData.length > 0) {
            seriesTitle = twoLevelFigureData[0].seriesTitle;
        }
        let chartInstance = null;
        let chartInstances = [];
        let xLabel = '';
        if (chartType === 'twolevelgroupeddata') {
            if('' != null && ''.length > 0)
                xLabel = '';
            else
                xLabel = twoLevelFigureData[0].categoriesTitleOuter + ' and ' + twoLevelFigureData[0].categoriesTitle.toLowerCase();
        }
        else
            xLabel = chartDirection == 'horizontal' ? '' : figureData.categoriesTitle;

        let isSingleSerieWithTotalCategory = false;
        let hasUnitedStatesAndOECD = false;
isSingleSerieWithTotalCategory = false
hasUnitedStatesAndOECD = false        // check if there are gaps in years

        // default options object
        const options = {
            element: element,
            showGrid: true,
            xAxisSkip: xAxisSkip,
            showGroupedHover: true,
            isPercentage: isPercentage,
            formatMillions: formatMillions,
            formatBillions: formatBillions,
            maxScale: maxScale,
            ticksNumber: ticksNumber,
            projectionYear: null,
            roundValues: true,
            style: {
                margin: { top: 30, right: 30, bottom: 30, left: 30 },
                width: 750,
                height: 350,
            },
            x: {
                label: xLabel,
                padding: 0.2,
                addDollarToTop: false,
                'break': {
                    margin: null,
                    maxValue: ''
                },
                bold: false,
                labelHide: false
            },
            y: {
                label: "Average amount of aid",
                addDollarToTop: true,
                'break': {
                    margin: null,
                    maxValue: ''
                }
            },
            tooltip: {
                prefixDollar: false,
                tooltipRound: 100,
                marginOfErrorDecimals: null
            },
            table: {
                tableRound: 0
            },
            colors: chartHelpers.getColorsForFigureData(figureData, twoLevelFigureData, chartType), //['#008624', '#FCC46C', '#84329B', '#6DB2E5'],
            yearsHaveGaps: chartHelpers.getYearsHaveGaps(figureData, chartType),
            isSingleSerieWithTotalCategory: isSingleSerieWithTotalCategory,
            hasUnitedStatesAndOECD: hasUnitedStatesAndOECD
        }
        Object.defineProperty(options, 'element', { writable: false });
        Object.defineProperty(options, 'maxScale', { writable: false });
        //Object.freeze(options.style);


        let barTrendData = null; // trend bar
        let barData = null; // bar

        // when legend checkbox is clicked, sync 'checked' status to
        // checkbox in sidebar (Modify Chart container)
        const syncLegendAndToolbarCheckbox = (ele, container) => {
            const text = $(ele).attr("data-text");
            const checked = $(ele).prop('checked');
            const checkbox = $(wrap).find(container).find("input").filter(function () {
                return $(this).attr("data-text") === text;
            }).first();
            $(checkbox).prop('checked', checked);
        }

        // event handler for series below chart checkboxes
        $(wrap).on("click", ".check-legend", function (ev) {

            // set 'visible' to series by index
            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            if (dataType === 'series') {
                if (chartType === 'twolevelgroupeddata') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series[dataIndex].visible = ev.target.checked;
                    });
                }
                else {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;

                    //figureData.series[dataIndex].visible = ev.target.checked;
                }
            }
            else if (dataType === 'categories') {
                let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                if (!hasOtherChecked)
                    ev.target.checked = true; // cannot uncheck last checkbox
                else
                    figureData.categories[dataIndex].visible = ev.target.checked;

                //figureData.categories[dataIndex].visible = ev.target.checked;
            }
            syncLegendAndToolbarCheckbox(this, ".options-container-body");
            draw();
        });

        // click event for checkboxes in "Modify chart" toolbar
        $(wrap).on("click", ".options-container-body input", function (ev) {

            let dataIndex = ev.target.getAttribute('data-index');
            let dataType = ev.target.getAttribute('data-type');
            let dataText = ev.target.getAttribute('data-text');

            if (chartType === 'twolevelgroupeddata') {
                // check to make sure user does not uncheck all checkboxes
                let stopClickEvent = false;
                if (dataType === 'series') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.series.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (dataType === 'categories2') {
                    let hasOtherChecked = twoLevelFigureData.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }

                if (dataType === 'categories') {
                    let hasOtherChecked = twoLevelFigureData.some((figureDataItem, index) => {
                        return figureDataItem.categories.some((el, index) => el.visible && index !== +dataIndex);
                    });
                    if (!hasOtherChecked) {
                        ev.target.checked = true;
                        stopClickEvent = true;
                    }
                }
                if (!stopClickEvent) {
                    twoLevelFigureData.forEach(figureData => {
                        if (dataType === 'series')
                            figureData.series[dataIndex].visible = ev.target.checked;

                        if (dataType === 'categories2' && figureData.key === dataText)
                            figureData.visible = ev.target.checked;

                        if (dataType === 'categories') {
                            let index = figureData.categories.findIndex(c => c.key === dataText);
                            if (index > -1) {
                                figureData.categories[index].visible = ev.target.checked;
                            }
                        }
                    });
                }
            }
            else {
                // set 'visible' to variable by index
                if (dataType === 'series') {
                    let hasOtherChecked = figureData.series.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.series[dataIndex].visible = ev.target.checked;
                }
                else if (dataType === 'categories') {
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                }
            }
            syncLegendAndToolbarCheckbox(this, ".legends");
            draw();
        });

        // click event for "Modify chart"
        $(wrap).find(".modify").click(function (ev) {
            $(ev.target).addClass('d-none');
            $(this).closest(".container-figure").find(".options-container").toggleClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });
        });

        // confidence interval IMAGE click event handler
        $(wrap).on("click", "#toggle-icon-__d709dfbabbe1486695ea8eb4e19fdd13", function (ev) {
            $(wrap).find("#error-check-__d709dfbabbe1486695ea8eb4e19fdd13").click();
        });

        // confidence interval INPUT element click event handler
        $(wrap).on("click", "#error-check-__d709dfbabbe1486695ea8eb4e19fdd13", function (ev) {
            draw();
            // update image
            var onSrc = $("#toggle-icon-__d709dfbabbe1486695ea8eb4e19fdd13").attr('data-on-src');
            var offSrc = $("#toggle-icon-__d709dfbabbe1486695ea8eb4e19fdd13").attr('data-off-src');
            if (ev.target.checked) {
                $("#toggle-icon-__d709dfbabbe1486695ea8eb4e19fdd13").attr('src', onSrc);
            } else {
                $("#toggle-icon-__d709dfbabbe1486695ea8eb4e19fdd13").attr('src', offSrc);
            }
        });

        // event handler for switching chart view: line, bar, etc
        $(wrap).find('.chart-view-toggle').click(ev => {
            $(wrap).find('.chart-view-toggle').removeClass('active');
            $(ev.target).addClass('active');
            chartView = ev.target.getAttribute('data-type');

            // hide or show buttons in Share toolbox
            if (chartView === 'table')
                $('.share-download-figure').addClass('d-none');
            else
                $('.share-download-figure').removeClass('d-none');

            draw();
        });

        // CLOSE link inside Modify chart
        $(wrap).find('.options-container-footer').find('a').on('click', ev => {
            ev.preventDefault();
            $(ev.target).closest(".container-figure").find(".options-container").removeClass("active");

            if (chartInstance.resize)
                chartInstance.resize();
            chartInstances.forEach(instance => {
                if (chartInstance.resize)
                    instance.resize();
            });

            $(wrap).find('.modify').removeClass('d-none');
            draw();
        });

        // get checked status of Confidence Interval checkbox
        const getConfidenceIntervalStatus = () => $(wrap).find("#error-check-__d709dfbabbe1486695ea8eb4e19fdd13").is(":checked");

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxes(groupTitle, subgroupLabel) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase().includes("year")) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);
            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.categoriesTitle) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Clear All</a></div>")
            if (chartType === 'trend') {
                for (let i = figureData.categories.length - 1; i > -1; i--) {
                    let item = figureData.categories[i];
                    div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                }
            }
            else {
                figureData.categories.forEach(function (item, i) {
                    div.append("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                });
            }
            $(wrap).find(".options-container-body").append(div);
        };

        function appendCheckboxesWithHeaders(label) {
            $(wrap).find(".options-container-body").html("");

            var div = $("<div>");
            div.attr("class", "group-wrap series-wrapper");
            if (figureData.series.length > 1) {
                div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder(figureData.seriesTitle) + "</h5>");
                div.append("<div class='select-clear'><a href='#' class='btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Clear All</a></div>")
                if (figureData.seriesTitle.toLowerCase() === "year" || figureData.seriesTitle.toLowerCase() === "years") {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    }
                }
                else {
                    figureData.series.forEach(function (item, i) {
                        div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                    });
                }
                $(wrap).find(".options-container-body").append(div);

                // add event handlers for select-all and unselect all
                $(wrap).find('.series-wrapper').find('.btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', false);
                    $(wrap).find('.series-wrapper').find('input').first().prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = !!checked;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', !!checked);
                    });
                    draw();
                });

                $(wrap).find('.series-wrapper').find('.btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13').click(function (ev) {
                    ev.preventDefault();

                    $(wrap).find('.series-wrapper').find('input').prop('checked', true);
                    $(wrap).find('.series-wrapper').find('input').each(function (index, el) {
                        let checked = $(el).prop('checked');
                        let dataIndex = $(el).attr('data-index');
                        figureData.series[dataIndex].visible = true;

                        // sync with legend
                        $(wrap).find('.legends').find('input[data-type="series"][data-index="' + dataIndex + '"]').prop('checked', true);
                    });
                    draw();
                });

            }
            div = $("<div>");
            div.attr("class", "group-wrap no-border categories-wrapper");
            div.append("<h5 class='group-title'> " + chartHelpers.replaceSupPlaceholder(label) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Clear All</a></div>")

            const groupedCategories = [];
            figureData.categories.forEach((category, index) => {
                if (category.header && !category.dataAsHeader) {
                    groupedCategories.push({
                        key: category.key,
                        label: category.label,
                        realCategoryIndex: index,
                        categories: [],
                        id: category.id,
                        isParent: true
                    });
                }
                else {
                    if (groupedCategories.length > 0) {
                        if(groupedCategories[groupedCategories.length - 1].categories && groupedCategories[groupedCategories.length - 1].isParent) {
                            groupedCategories[groupedCategories.length - 1].categories.push(category);
                            groupedCategories[groupedCategories.length - 1].categories[groupedCategories[groupedCategories.length - 1].categories.length - 1].realCategoryIndex = index;
                        }
                        else {
                            groupedCategories.push({
                                key: category.key,
                                label: category.label,
                                realCategoryIndex: index,
                                hasNoParent: true,
                                category: category,
                                id: category.id
                            });
                         }
                    }
                    else {
                        groupedCategories.push({
                            key: category.key,
                            label: category.label,
                            realCategoryIndex: index,
                            hasNoParent: true,
                            category: category,
                            id: category.id
                        })
                    }
                }
            });


            groupedCategories.forEach((item, i) => {

                if (item.hasNoParent && item.category) {
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.category.label) + "<input type='checkbox' data-text='" + item.category.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);
                }
                else {

                    const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                    // parent checkbox
                    const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                    const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.label) + "<input type='checkbox' data-id='" + item.id + "' data-text='" + item.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check header-category' data-type='categories' data-index=" + item.realCategoryIndex + " /><span class='checkmark'></span> <img src='" + plusIconUrl + "' class='show-child-checkboxes' data-state='closed' data-id='" + item.id + "' data-category='" + item.key + "' /></label>");
                    divCheckbox.append(label);
                    div.append(divCheckbox);



                    // children checkboxes (select all | unselect all)
                    let innerDiv = $("<div class='chart-checkbox-childinput d-none' data-parent-id='" + item.id + "' data-parent-category='" + item.key + "'></div>");
                    innerDiv.append("<div class='select-clear'><a href='#' class='btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13-children' data-parent-id='" + item.id + "' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13-children' data-parent-id='" + item.id + "' data-type='categories'>Clear All</a></div>")
                    // children checkboxes
                    item.categories.forEach((itemChild, iChild) => {
                        const divCheckbox = $("<div class='chart-checkbox' style='overflow-wrap: break-word;  word-wrap: break-word;  hyphens: auto;'></div>");
                        const label = $("<label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(itemChild.label) + "<input type='checkbox' data-text='" + itemChild.key + "' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check child-category' data-type='categories' data-index=" + itemChild.realCategoryIndex + " /><span class='checkmark'></span></label>");
                        divCheckbox.append(label);
                        innerDiv.append(divCheckbox);
                    });

                    div.append(innerDiv);
                }
            });

            $(wrap).find(".options-container-body").append(div);

            // parent checkbox event handler
            $(wrap).find('.header-category').click(function (ev) {
                const totalChecked = $(wrap).find('input.header-category:checked').length;
                if(totalChecked == 0) {
                    ev.target.checked = true;
                    ev.preventDefault();
                    return;
                }

                // when user clicks on header/parent category
                const checked = ev.target.checked;
                const itemKey = ev.target.getAttribute('data-text');
                const childCheckboxes = $(wrap).find('div[data-parent-category="' + itemKey + '"]').find('input');
                $(childCheckboxes).attr('checked', checked);
                $(childCheckboxes).prop('checked', checked);

                $(childCheckboxes).each(function (index, checkbox) {
                    let dataIndex = checkbox.getAttribute('data-index');
                    let hasOtherChecked = figureData.categories.some((el, index) => el.visible && index !== +dataIndex);
                    if (!hasOtherChecked)
                        ev.target.checked = true; // cannot uncheck last checkbox
                    else
                        figureData.categories[dataIndex].visible = ev.target.checked;
                });
                //draw();
            });

            // child checkbox logic
            $(wrap).find('.child-category').click(function (ev) {
                debugger;
                
                // this is the number of 'parent' checkboxes chacked 
                const totalParentCheckboxesChecked = $(wrap).find('input.header-category:checked').length;

                // get parent div
                // check if none is checked in group, uncheck parent checkbox
                const checkedCheckboxesLength = $(this).parents('.chart-checkbox-childinput').find('input:checked').length;
                const parentCategoryKey = $(this).parents('.chart-checkbox-childinput').attr('data-parent-category');
                const parentCheckbox = $(wrap).find('.header-category[data-text="' + parentCategoryKey + '"]');
                if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked > 1) {
                    // uncheck parent checkbox
                    $(parentCheckbox).attr('checked', false);
                    $(parentCheckbox).prop('checked', false);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = false;
                } else if (checkedCheckboxesLength == 0 && totalParentCheckboxesChecked == 1) {
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);

                    $(ev.target).attr('checked', true);
                    $(ev.target).prop('checked', true);

                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }                
                else {
                    // make sure parent checkbox is checked when at least 1 child checkbox is checked
                    $(parentCheckbox).attr('checked', true);
                    $(parentCheckbox).prop('checked', true);
                    let dataIndex = parentCheckbox.attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                }
            });

            $(wrap).find(".options-container-body").find('.show-child-checkboxes').click(ev => {
                ev.preventDefault();
                //let category = ev.target.getAttribute('data-category');
                let parentId = ev.target.getAttribute('data-id');
                const plusIconUrl = '/programs/coe/images/square-plus-regular.svg';
                const minusIconUrl = '/programs/coe/images/square-minus-regular.svg';
                let state = ev.target.getAttribute('data-state');
                if (state == 'closed') {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').removeClass('d-none');
                    $(ev.target).attr('data-state', 'opened');
                    $(ev.target).attr('src', minusIconUrl);
                }
                else {
                    $(wrap).find('div[data-parent-id="' + parentId + '"').addClass('d-none');
                    $(ev.target).attr('data-state', 'closed');
                    $(ev.target).attr('src', plusIconUrl);
                }

            });

            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox-childinput').find('input').prop('checked', false);

                let firstParentDiv = $(parent).find('.chart-checkbox').first();
                firstParentDiv.find('input').prop('checked', true);

                let firstParentCheckboxCategory = firstParentDiv.find('input').attr('data-text');
                let childCheckboxesDiv = $(parent).find('.chart-checkbox-childinput[data-parent-category="' + firstParentCheckboxCategory + '"]');
                childCheckboxesDiv.find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.group-wrap');

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked', true);
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = true;
                });
                draw();
            });


            $(wrap).find('.categories-wrapper').find('.btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', false);
                $(parent).find('.chart-checkbox').first().find('input').prop('checked', true);

                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

            $(wrap).find('.categories-wrapper').find('.btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13-children').click(function (ev) {
                ev.preventDefault();
                let parent = $(ev.target).parents('.chart-checkbox-childinput');
                // find first checkbox and select only it
                $(parent).find('.chart-checkbox').find('input').prop('checked', true);
                $(parent).find('input').each(function (index, el) {
                    let checked = $(el).prop('checked');
                    let dataIndex = $(el).attr('data-index');
                    figureData.categories[dataIndex].visible = !!checked;
                });
                draw();
            });

        }

        // adds checkboxes into Modify Chart sidebar
        function appendCheckboxesForTwoLevelFigureData() {
            $(wrap).find(".options-container-body").html("");

            let firstFigureData = twoLevelFigureData.length > 0 ? twoLevelFigureData[0] : null;

            let addedSeries = [];
            var div = $("<div></div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.seriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='series'>Clear All</a></div>")
            twoLevelFigureData.forEach(figureData => {

                if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year"))) {
                    for (let i = figureData.series.length - 1; i >= 0; i--) {
                        const item = figureData.series[i];
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);
                            div.append("<div class='chart-checkbox'><label class='check blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>")
                        }
                    }
                }
                else {
                    if(figureData.series.length === 1)
                    {
                        $(div).addClass('d-none');
                    }

                    figureData.series.forEach(function (item, i) {
                        if (addedSeries.indexOf(item.key) == -1) {
                            addedSeries.push(item.key);

                            div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check' data-type='series' data-index=" + i + " data-text='" + item.key + "' /><span class='checkmark'></span></label></div>")
                        }
                    });
                }
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap no-border");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitle : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories'>Clear All</a></div>")
            let addedCategories = [];
            twoLevelFigureData.forEach((figureData, i) => {
                figureData.categories.forEach((category, categoryIndex) => {
                    if (addedCategories.indexOf(category.key) == -1) {
                        addedCategories.push(category.key);
                        div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(category.key) + "<input type='checkbox' data-text=\"" + category.key + "\" " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories' data-index=" + categoryIndex + " /><span class='checkmark'></span></label></div>")
                    }
                });
            });
            $(wrap).find(".options-container-body").append(div);


            div = $("<div>");
            div.attr("class", "group-wrap");
            div.append("<h5 class='group-title'>" + chartHelpers.replaceSupPlaceholder((firstFigureData ? firstFigureData.categoriesTitleOuter : '')) + "</h5>");
            div.append("<div class='select-clear'><a href='#' class='btn-twolevel-select-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories2'>Select all</a><span>|</span><a href='#' class='btn-twolevel-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13' data-type='categories2'>Clear All</a></div>")
            twoLevelFigureData.forEach((figureData, i) => {
                div.append("<div class='chart-checkbox'><label class='check- blue-cb'>" + chartHelpers.replaceSupPlaceholder(figureData.key) + "<input type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.categories) + " checked class='check' data-type='categories2' data-index=" + i + " data-text=\"" + figureData.key + "\" /><span class='checkmark'></span></label></div>")
            });
            $(wrap).find(".options-container-body").append(div);

            
        };

        // draw legends below chart
        function drawLegends() {
            $(wrap).find(".legends").html("");

            if (chartType === 'trend' && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");

                });
            }
            else if ((chartType === 'onelevelgroupeddata' || chartType === 'onelevelgroupedwithheaders') && figureData.series.length > 1) {
                figureData.series.forEach(function (item, i) {
                    $(wrap)
                        .find(".legends")
                        .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(item.key) + "<input data-text='" + item.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                });
            }
            else if (chartType === 'twolevelgroupeddata') {
                let addedSeries = [];
                
                let seriesCount = 0;
                twoLevelFigureData.forEach((figureData, figureDataIndex) => {
                    if(figureData.series.length > seriesCount)
                        seriesCount = figureData.series.length;

                    figureData.series.forEach(function (serie, i) {
                        if (addedSeries.indexOf(serie.key) == -1) {
                            addedSeries.push(serie.key);

                            $(wrap)
                                .find(".legends")
                                .append("<div style='padding: 0 10px'><div class='legend-indicator' style='background-color: " + options.colors[i] + "'></div><label class='blue-cb'>" + chartHelpers.replaceSupPlaceholder(serie.key) + "<input data-text='" + serie.key + "' type='checkbox' " + chartHelpers.disabledInputIfSeriesLessThan2(figureData.series) + " checked class='check-legend' data-type='series' data-index=" + i + " /><span class='checkmark'></span></label></div>");
                        }
                    });
                });
                if(seriesCount == 1) {
                    $(wrap).find(".legends").empty();
                }
            }
        }

        // main function that draws chart
        function draw() {
            options.style.originalWidth = options.style.width;
            options.yearsHaveGaps = chartHelpers.getYearsHaveGaps(figureData, chartType);
            const filteredFigureData = chartHelpers.filterFigureData(figureData);
            const filteredTwoLevelFigureData = chartHelpers.filterTwoLevelFigureData(twoLevelFigureData);

            const filteredColors = chartHelpers.filterColors(figureData, options.colors);
            const twoLevelFilteredColors = chartHelpers.filterTwoLevelFigureDataColors(twoLevelFigureData, options.colors);

            // show message about years irregular intervals
            if (options.yearsHaveGaps && chartView !== 'table') {
                $(wrap).find('.years-interval-message').addClass('visible');
            } else {
                $(wrap).find('.years-interval-message').removeClass('visible');
            }


            // show legend color indicators by default
            $(wrap).find('.legend-indicator').removeClass('d-none');
            $('#footnote-table-view-__d709dfbabbe1486695ea8eb4e19fdd13').addClass('d-none');

            $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13-file').css('display', 'none');
            $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'block');
            $('#table-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'none');

            // remove all "Line Multiples" before we render any chart
            $(wrap).find('.small-multiples-container').remove();

            if (chartType === 'trend' && chartView === 'line-multi') {
                options.style.margin.bottom = 45;

                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 50;

                let config = {
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                };

                // split figure data into multiple data objects, one for each serie
                const listChartConfig = chartHelpers.createMultipleChartConfigs(config);



                const originalSvgWrapper = $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13');
                // remove svg with multiple lines
                $(originalSvgWrapper).find('svg').remove();

                // remove all dynamically created charts
                $(wrap).find('.small-multiples-container').remove();

                let allChartsContainer = $('<div class="small-multiples-container"></div>');
                $(originalSvgWrapper).after(allChartsContainer);

                let b_row = $('<div class="row"></div>');
                $(allChartsContainer).append(b_row);
                let b_col = null;
                for (let chartConfigIndex = 0; chartConfigIndex < listChartConfig.length; chartConfigIndex++) {
                    const serieTitle = listChartConfig[chartConfigIndex].series[0].key

                    

                    //var chartContainer = $('<div style="float: left; width: 50%; max-width:50%; __margin-right: 10px; border:1px solid #cc6600;"></div>');
                    var chartContainer = $('<div class="col-md-6"></div>');
                    b_row.append(chartContainer);

                    //$(allChartsContainer).append(chartContainer);

                    $(chartContainer).append("<div class='line-multi-serieslabel'>" + chartingUtils.replaceSupPlaceholder(serieTitle) + "</div>");
                    $(chartContainer).append("<div class='chart-wrapper-clone' id='chart-__d709dfbabbe1486695ea8eb4e19fdd13_serie" + chartConfigIndex + "' style='display: inline-block;'></div>");
                    

                    let chartInstance = new Line({
                        ...listChartConfig[chartConfigIndex],
                        showErrors: getConfidenceIntervalStatus(),
                        ticksNumber: 5,
                        xAxisSkip: 4
                    });
                    chartInstances.push(chartInstance);
                }
                
                $(allChartsContainer).append('<div style="clear: both;"></div>');

                chartInstance = null;
            }
            else if (chartType === 'trend' && chartView === 'line') {
                // for line, margin bottom should not be big
                options.style.margin.bottom = 45;
                options.style.margin.right = 30;
                options.style.margin.top = 30;
                options.style.margin.left = 50;
                chartInstance = new Line({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'trend' && chartView === 'bar') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 50;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors
                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.bottom = 50;
                options.style.margin.left = 50;
                chartInstance = new BarChart({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.style.height = 330;
                options.y.padding = 0.2;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'onelevelgroupedwithheaders' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.style.height = 330;
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors

                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'vertical') {
                options.style.margin.left = 50;
                options.style.margin.bottom = 30;
                options.style.margin.right = 0;
                chartInstance = new GroupedBar({
                    ...options,
                    barPadding: 0.3,
                    showErrors: getConfidenceIntervalStatus(),
                    twoLevelData: filteredTwoLevelFigureData,
                    colors: twoLevelFilteredColors
                });
            }
            else if (chartType === 'twolevelgroupeddata' && chartView === 'bar' && chartDirection == 'horizontal') {
                options.style.margin.bottom = 40;
                options.style.margin.right = 10;
                options.style.margin.top = 20;
                options.style.margin.left = 50;
                options.x.label = '';
                chartInstance = new HorizontalBar({
                    ...options,
                    showErrors: getConfidenceIntervalStatus(),
                    categories: filteredFigureData.categories,
                    series: filteredFigureData.series,
                    colors: filteredColors,
                });
            }
            else if (chartView === 'file') {
                $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13-file').css('display', 'block');
                $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'none');
                $('#table-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'none');
            }
            else if (chartView === 'table') {
                $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13-file').css('display', 'none');
                $('#chart-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'none');
                $(wrap).find('.chart-wrapper-clone').css('display', 'none');
                $('#table-__d709dfbabbe1486695ea8eb4e19fdd13').css('display', 'block');
                $('#footnote-table-view-__d709dfbabbe1486695ea8eb4e19fdd13').removeClass('d-none');

                // hide legend color indicators
                $(wrap).find('.legend-indicator').addClass('d-none');

                if (chartType !== 'twolevelgroupeddata') {
                    chartInstance = new Table({
                        containerId: 'table-__d709dfbabbe1486695ea8eb4e19fdd13',
                        figureData: filteredFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        categoriesTitle: figureData.categoriesTitle,
                        hasAnySe: false,
                        projectionYear: options.projectionYear,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        tableRound: options.table.tableRound,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
                else {
                    chartInstance = new TwoLevelTable({
                        containerId: 'table-__d709dfbabbe1486695ea8eb4e19fdd13',
                        figures: filteredTwoLevelFigureData,
                        showConfidenceInterval: getConfidenceIntervalStatus(),
                        isPercentage: isPercentage,
                        formatMillions: formatMillions,
                        formatBillions: formatBillions,
                        chartType: chartType,
                        horizontalLabel: '',
                        categoriesTitleOuter: filteredTwoLevelFigureData[0].categoriesTitleOuter,
                        categoriesTitle: filteredTwoLevelFigureData[0].categoriesTitle,
                        hasAnySe: false,
                        roundValues: options.roundValues,
                        prefixDollar: false,
                        x: options.x,
                        y: options.y
                    });
                    //chartingUtils.logChart(tableInstance, figureNumber);
                }
            }

            chartingUtils.logChart(chartInstance, figureNumber);
            chartInstances.forEach(ci => chartingUtils.logChart(ci, figureNumber));
        }

        // Clear all event handler inside siebar
        function addClearAllEventHandler() {
            $('.btn-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13').on('click', (ev) => {
                ev.preventDefault();

                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    if (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("year"))
                        figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                    else
                        figureData.series.forEach((serie, index) => serie.visible = index == 0);
                }
                if (type === 'categories') {
                    if (chartType === 'trend') {
                        // check if there is projection year, then keep it selected
                        if (projectionYear)
                            figureData.categories.forEach((category, index) => category.visible = category.key === projectionYear.toString());
                        else
                            figureData.categories.forEach((category, index) => category.visible = index === (figureData.categories.length - 1));
                    }
                    else {
                        let defaultSelection = '';
                        if(defaultSelection) {
                            figureData.categories.forEach((category, index) => {
                                category.visible = category.key.toLowerCase().includes(defaultSelection);
                            });
                        }
                        else
                            figureData.categories.forEach((category, index) => category.visible = index == 0);
                    }
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series')
                        $(el).prop('checked', figureData.series[dataIndex].visible);
                    else if (type === 'categories')
                        $(el).prop('checked', figureData.categories[dataIndex].visible);
                });

                draw();
            });
        }

        // Select all event handler inside sidebar
        function addSelectAllEventHandler() {
            $('.btn-select-all-__d709dfbabbe1486695ea8eb4e19fdd13').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    figureData.series.forEach((serie, index) => {
                        serie.visible = true;
                    });

                }
                if (type === 'categories') {
                    figureData.categories.forEach((category, index) => {
                        category.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    $(el).prop('checked', true);
                });

                draw();
            });
        }


        // Clear all event handler inside siebar for two-level data
        function addTwoLevelClearAllEventHandler() {
            $('.btn-twolevel-clear-all-__d709dfbabbe1486695ea8eb4e19fdd13').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    let isYears = false;
                    twoLevelFigureData.forEach(figureData => {
                        if (figureData.seriesTitle && (figureData.seriesTitle.toLowerCase().includes("year") || figureData.seriesTitle.toLowerCase().includes("years"))) {
                            isYears = true;
                        }

                        figureData.series.forEach((serie, index) => {
                            if (isYears) {
                                figureData.series.forEach((serie, index) => serie.visible = index == figureData.series.length - 1);
                            }
                            else {
                                if (index > 0)
                                    serie.visible = false;
                            }
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            if (index > 0)
                                category.visible = false;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = index === 0;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    if (type === 'series') {
                        $(el).prop('checked', twoLevelFigureData[0].series[dataIndex].visible);
                    }
                    else if (type === 'categories') {
                        $(el).prop('checked', twoLevelFigureData[0].categories[dataIndex].visible);
                    }
                    else if (type === 'categories2') {
                        $(el).prop('checked', twoLevelFigureData[dataIndex].visible);
                    }
                    //if(dataIndex > 0)
                    //    $(el).prop('checked', false);
                });

                draw();
            });
        }

        // Select all event handler inside siebar for two-level data
        function addTwoLevelSelectAllEventHandler() {
            $('.btn-twolevel-select-all-__d709dfbabbe1486695ea8eb4e19fdd13').on('click', (ev) => {
                ev.preventDefault();
                var type = ev.target.getAttribute('data-type');
                if (type === 'series') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.series.forEach((serie, index) => {
                            serie.visible = true;
                        });
                    });
                }
                if (type === 'categories') {
                    twoLevelFigureData.forEach(figureData => {
                        figureData.categories.forEach((category, index) => {
                            category.visible = true;
                        });
                    });
                }
                if (type === 'categories2') {
                    twoLevelFigureData.forEach((figureData, index) => {
                        figureData.visible = true;
                    });
                }

                let inputs = $(wrap).find('input[data-type="' + type + '"]');
                $(inputs).each((inputIndex, el) => {
                    let dataIndex = +el.getAttribute('data-index');
                    $(el).prop('checked', true);
                });

                draw();
            });
        }

        // Embed backdrop element that will dissapear on click (background shaddow)
        $(wrap).find('.embed-wrapper').on('click', function (ev) {
            let embedBg = $(wrap).find('.embed-wrapper');
            if ($(ev.target).is(embedBg)) {
                $(ev.target).addClass('d-none');
            };
        });

        // Embed UI "Copy" button event handler
        $(wrap).find('.embed-wrapper').find('button').on('click', function () {
            let btn = $(wrap).find('.embed-wrapper').find('button');
            btn.html('Copied!');
            setTimeout(function () {
                btn.html('Copy');
            }, 2000);
        });
        // Embed UI "Close" button event handler
        $(wrap).find('.embed-wrapper').find('.close').on('click', function () {

            let embedBg = $(wrap).find('.embed-wrapper').addClass('d-none');

        });
        // Share Embed link click event - shows emebed popup
        $(wrap).find('.link-embed').on('click', function (ev) {
            ev.preventDefault();
            $(wrap).find('.embed-wrapper').removeClass('d-none');

            let container = $('#figure-' + '1197');
            const width = Math.ceil(container.outerWidth()) + 20;
            const height = Math.ceil(container.outerHeight()) + 20;
            const url = 'http://nces.ed.gov/programs/coe/iframe/index?code=CUC&figureNumber=' + '6';
            let html = '<iframe src="' + url + '" width=' + width + ' height=' + height + '  style="border-width: 0;"></iframe>';
            $(wrap).find('.embed-wrapper').find('textarea').val(html)
        });

        // Download data icon event handler
        $(wrap).find('.link-download-data').on('click', function (ev) {
            ev.preventDefault();
            console.log('[link-download-data] figureData: ', figureData)
            let dataToDownload = figureData;
            if (chartType === 'twolevelgroupeddata')
                dataToDownload = twoLevelFigureData;

            let footnotes = [];
footnotes.push({ sup: '1', content: 'Student loans include only loans made directly to students; they do not include Parent PLUS Loans or other loans made directly to parents.' }); footnotes.push({ sup: '', content: 'NOTE: Data represent the 50 states and the District of Columbia. Degree-granting institutions grant associate"s or higher degrees and participate in Title IV federal financial aid programs. Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. Award amounts are in constant 2020–21 dollars, based on the Consumer Price Index (CPI). Averages exclude students who were not awarded financial aid.' }); footnotes.push({ sup: '', content: 'SOURCE: U.S. Department of Education, National Center for Education Statistics, Integrated Postsecondary Education Data System (IPEDS), Winter 2020–21, Student Financial Aid component. See <i>Digest of Education Statistics 2021</i>, table <a href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">331.20</a>.' });                 
    
        let content = chartingUtils.generateCSVContent(
                    dataToDownload,
                    'Figure 6. Average amount of financial aid awarded to first-time, full-time undergraduate students at 2-year degree-granting postsecondary institutions, by type of financial aid and control of institution: Academic year 2019&#x2013;20',
                    chartType,
                    false,
                    footnotes,
                    projectionYear,
                    getConfidenceIntervalStatus(),
                    '',
                    '[in constant 2020&#x2013;21 dollars]'
                );
            // Create a blob
            //var blob = new Blob(["\ufeff", content], { type: 'text/csv' });
            var BOM = "\uFEFF";
            var csvData = BOM + content;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });

            var url = URL.createObjectURL(blob);

            // Create a link to download it
            var pom = document.createElement('a');
            pom.href = url;
            pom.setAttribute('download', 'CUC-figure-6.csv');
            pom.click();
        });


        // CREATING CHART
        sessionStorage.clear();
        // draw legends below svg element
        drawLegends();
        // add checkboxes to "Modify Chart" toolbar
        if (chartType === 'onelevelgroupedwithheaders') {
            appendCheckboxesWithHeaders(options.y.label);
        }
        else if (chartType !== 'twolevelgroupeddata') {
            appendCheckboxes();
            addClearAllEventHandler();
            addSelectAllEventHandler();
        }
        else {
            appendCheckboxesForTwoLevelFigureData();
            addTwoLevelClearAllEventHandler();
            addTwoLevelSelectAllEventHandler();
        }
        // draw chart
        draw();

    })($);

    function removeChartInteractiveContainer(ev) {
        $(ev.currentTarget).remove();
        setChartInteractiveCookie();
    }


</script>
      <div data-p="6" data-c-id="1457" data-figure-number="6" data-c-seq="8" class="component-paragraph" id="component-1457">
       <div>
        The average amount of financial aid awarded to first-time, full-time degree-seeking undergraduates also varied by control at 2-year institutions and particularly for institutional grants. Across 2-year institutions in academic year 2019–20, the average federal grant award ranged from $4,700 at private for-profit institutions to $5,900 at private nonprofit institutions (reported in constant 2020–21 dollars). Average state or local grant awards were highest at private nonprofit institutions ($3,900), followed by private for-profit institutions ($2,800) and public institutions ($2,300). There were larger differences by control of institution in institutional grant aid. The average institutional grant award was more than three times higher at private nonprofit institutions ($8,100) than at public institutions ($2,100) and private for-profit institutions ($1,600). Average student loan amounts were higher at private for-profit institutions ($7,800) and private nonprofit institutions ($6,500) than at public institutions ($4,800).
       </div>
       <div id="component-1457-links" class="controls d-flex">
        <div class="flex-grow-1">
         <a href="#" class="d-none prev-finding-link" data-component-id="1457"><img src="/programs/coe/images/caret-left-solid.svg" alt=""> Previous Finding</a>
        </div>
        <div class="">
         <a href="" class="d-none next-finding-link" data-component-id="1457">Next Finding <img src="/programs/coe/images/caret-right-solid.svg" alt=""></a> <a href="" class="d-none select-another-subgroup-link" data-component-id="1457">Select Another Subgroup Characteristic <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
        </div>
       </div>
      </div><!-- Indicator footnotes -->
      <br>
      <div class="separator col-md-6 pl-0">
       <div class="line line--secondary"></div>
      </div>
      <div class="footnotes">
       <p><a id="fn1" style="position: relative; top: -30px;"></a> <sup><a href="#fr1" data-footnote="scroll">1</a></sup> Parent PLUS Loans are taken out by parents of dependent students and are used toward the students’ undergraduate education. Parent PLUS Loans were available through both the William D. Ford Federal Direct Loan Program and the Federal Family Education Loan Program (FFELP) until FFELP was discontinued in 2010. Since then, Parent PLUS Loans have been referred to as Direct PLUS Loans.</p>
       <p><a id="fn2" style="position: relative; top: -30px;"></a> <sup><a href="#fr2" data-footnote="scroll">2</a></sup> Student financial aid includes any federal and private loans to students and federal, state/local, and institutional grants. For academic year 2009–10, the percentage of students with financial aid was reported as the percentage of students who “received aid.” Starting with academic year 2010–11, postsecondary institutions reported the same data as the percentage of students who “were awarded aid” to better reflect that some students were awarded aid but did not receive it.</p>
      </div><!-- Supplemental information accordion --> <a id="supplemental-information"></a>
      <div>
       <div class="separator">
        <div class="line line--primary"></div>
       </div>
       <h3 class="mt-3">Supplemental Information</h3>
       <div id="accordion" class="accordion">
        <div class="accordion__wrapper">
         <div class="accordion__header">
          <h5 class="mb-0"><button data-ev data-ev-n="click" data-ev-c="supplemental-information" data-ev-l="related-indicators" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse-1" aria-expanded="false" aria-controls="collapse-1"> Related Indicators and Resources </button></h5>
         </div>
         <div id="collapse-1" class="collapse accordion__body" aria-labelledby="heading-1" data-parent="#accordion">
          <div class="card-body">
           <div>
            <div class="d-flex mb-3">
             <div class="mr-2">
              <img src="/programs/coe/images/related-tables-icon.svg">
             </div>
             <div>
              <a data-ev data-ev-n="click" data-ev-c="supplemental-information-related-indicators" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/raceindicators/indicator_rec.asp">Financial Aid <i>[Status and Trends in the Education of Racial and Ethnic Groups]</i></a>
             </div>
            </div>
            <div class="d-flex mb-3">
             <div class="mr-2">
              <img src="/programs/coe/images/related-tables-icon.svg">
             </div>
             <div>
              <a data-ev data-ev-n="click" data-ev-c="supplemental-information-related-indicators" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/indicator_tua.asp">Financing Postsecondary Education in the United States <i>[The Condition of Education 2013 Spotlight]</i></a>
             </div>
            </div>
            <div class="d-flex mb-3">
             <div class="mr-2">
              <img src="/programs/coe/images/related-tables-icon.svg">
             </div>
             <div>
              <a data-ev data-ev-n="click" data-ev-c="supplemental-information-related-indicators" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/indicator/cub">Loans for Undergraduate Students</a>
             </div>
            </div>
            <div class="d-flex mb-3">
             <div class="mr-2">
              <img src="/programs/coe/images/related-tables-icon.svg">
             </div>
             <div>
              <a data-ev data-ev-n="click" data-ev-c="supplemental-information-related-indicators" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/indicator/cua">Price of Attending an Undergraduate Institution</a>
             </div>
            </div>
            <div class="d-flex mb-3">
             <div class="mr-2">
              <img src="/programs/coe/images/related-tables-icon.svg">
             </div>
             <div>
              <a data-ev data-ev-n="click" data-ev-c="supplemental-information-related-indicators" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/indicator/tub">Trends in Student Loan Debt for Graduate School Completers <i>[The Condition of Education 2018 Spotlight]</i></a>
             </div>
            </div>
           </div>
           <div class="close-panel">
            CLOSE
           </div>
          </div>
         </div>
        </div>
        <div class="accordion__wrapper">
         <div class="accordion__header">
          <h5 class="mb-0"><button data-ev data-ev-n="click" data-ev-c="supplemental-information" data-ev-l="data-sources" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse-2" aria-expanded="false" aria-controls="collapse-2"> Data Sources </button></h5>
         </div>
         <div id="collapse-2" class="collapse accordion__body" aria-labelledby="heading-2" data-parent="#accordion">
          <div class="card-body">
           <div>
            <a data-ev data-ev-n="click" data-ev-c="supplemental-information-data-sources" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/ipeds/">Integrated Postsecondary Education Data System (IPEDS)</a>
           </div>
           <div class="close-panel">
            CLOSE
           </div>
          </div>
         </div>
        </div>
        <div class="accordion__wrapper">
         <div class="accordion__header">
          <h5 class="mb-0"><button data-ev data-ev-n="click" data-ev-c="supplemental-information" data-ev-l="reference-tables" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse-3" aria-expanded="false" aria-controls="collapse-3"> Reference Tables </button></h5>
         </div>
         <div id="collapse-3" class="collapse accordion__body" aria-labelledby="heading-3" data-parent="#accordion">
          <div class="card-body">
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/table-cells.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-reference-tables" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/digest/d21/tables/dt21_331.20.asp">Table 331.20 (Digest 2021)</a>: First-time, full-time degree/certificate-seeking undergraduate students enrolled in degree-granting postsecondary institutions, by participation and average amount awarded in financial aid programs, and control and level of institution: 2000-01 through 2019-20;
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/table-cells.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-reference-tables" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/digest/d16/tables/dt16_331.20.asp">Table 331.20 (Digest 2016)</a>: Full-time, first-time degree/certificate-seeking undergraduate students enrolled in degree-granting postsecondary institutions, by participation and average amount awarded in financial aid programs, and control and level of institution: 2000-01 through 2014-15
            </div>
           </div>
           <div class="close-panel">
            CLOSE
           </div>
          </div>
         </div>
        </div>
        <div class="accordion__wrapper">
         <div class="accordion__header">
          <h5 class="mb-0"><button data-ev data-ev-n="click" data-ev-c="supplemental-information" data-ev-l="glossary-terms" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse-4" aria-expanded="false" aria-controls="collapse-4"> Glossary Terms </button></h5>
         </div>
         <div id="collapse-4" class="collapse accordion__body" aria-labelledby="heading-4" data-parent="#accordion">
          <div class="card-body">
           <div class="chip-wrap">
            <a href="/programs/coe/glossary#certificate" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Certificate"> <span class="chip"> Certificate </span> </a> <a href="/programs/coe/glossary#constant" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Constant dollars"> <span class="chip"> Constant dollars </span> </a> <a href="/programs/coe/glossary#control" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Control of institutions"> <span class="chip"> Control of institutions </span> </a> <a href="/programs/coe/glossary#degreegranting" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Degree-granting institutions"> <span class="chip"> Degree-granting institutions </span> </a> <a href="/programs/coe/glossary#financialaid" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Financial aid"> <span class="chip"> Financial aid </span> </a> <a href="/programs/coe/glossary#fulltime" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Full-time enrollment"> <span class="chip"> Full-time enrollment </span> </a> <a href="/programs/coe/glossary#postsecinstitution" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Postsecondary institutions (basic classification by level)"> <span class="chip"> Postsecondary institutions (basic classification by level) </span> </a> <a href="/programs/coe/glossary#private" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Private institution"> <span class="chip"> Private institution </span> </a> <a href="/programs/coe/glossary#publicschool" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Public school or institution"> <span class="chip"> Public school or institution </span> </a> <a href="/programs/coe/glossary#undergraduate" data-ev data-ev-n="click" data-ev-c="supplemental-information-glossary-terms" data-ev-l="Undergraduate students"> <span class="chip"> Undergraduate students </span> </a>
           </div>
           <div class="close-panel">
            CLOSE
           </div>
          </div>
         </div>
        </div>
        <div class="accordion__wrapper">
         <div class="accordion__header">
          <h5 class="mb-0"><button data-ev data-ev-n="click" data-ev-c="supplemental-information" data-ev-l="previous-versions" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse-5" aria-expanded="false" aria-controls="collapse-5"> Previous Versions of This Indicator </button></h5>
         </div>
         <div id="collapse-5" class="collapse accordion__body" aria-labelledby="heading-5" data-parent="#accordion">
          <div class="card-body">
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/2021/cuc_508c.pdf">Sources of Financial Aid</a> - May 2021
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/coe_cuc.pdf">Sources of Financial Aid</a> - May 2020
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2019_05.pdf">Sources of Financial Aid</a> - May 2019
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2018_05.pdf">Sources of Financial Aid</a> - May 2018
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2017_05.pdf">Sources of Financial Aid</a> - May 2017
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2016_05.pdf">Sources of Financial Aid</a> - May 2016
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2015_05.pdf">Grants and Loan Aid to Undergraduate Students</a> - May 2015
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2014_04.pdf">Grants and Loan Aid to Undergraduate Students</a> - April 2014
            </div>
           </div>
           <div class="d-flex mb-3">
            <div class="mr-2">
             <img src="/programs/coe/images/pdf-small.svg">
            </div>
            <div>
             <a data-ev data-ev-n="click" data-ev-c="supplemental-information-previous-versions" data-ev-l="_inner_" target="_blank" href="https://nces.ed.gov/programs/coe/pdf/Indicator_CUC/coe_cuc_2013_05.pdf">Grants and Loan Aid to Undergraduate Students</a> - May 2013
            </div>
           </div>
           <div class="close-panel">
            CLOSE
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="suggested-citation">
       <a id="suggested-citation"></a>
       <h4>Suggested Citation</h4>
       <div>
        National Center for Education Statistics. (2022). Sources of Financial Aid.&nbsp;<i>Condition of Education</i>.&nbsp;U.S. Department of Education, Institute of Education Sciences. Retrieved [date], from&nbsp;<a href="/programs/coe/indicator/cuc">https://nces.ed.gov/programs/coe/indicator/cuc</a>.
       </div>
      </div>
      <div class="d-flex justify-content-between align-content-center back-to-top mt-4">
       <div>
        <div class="mb-3">
         <a class="toggle-menu" href="/programs/coe#indicators"><img src="/programs/coe/images/arrow-backward.svg" alt=""> Explore another topic</a>
        </div><a class="toggle-menu" href="/programs/coe#subgroups"><img src="/programs/coe/images/arrow-backward.svg" alt=""> Explore by subgroup</a>
       </div>
       <div>
        <a class="pt-3" href="#top">Back to Top <img src="/programs/coe/images/bi-caret-up-fill.svg" alt=""></a>
       </div>
      </div>
     </div>
    </div>
   </div><img src="/programs/coe/images/back-to-top.svg" class="d-none" id="back-">
  </div>
  <script src="/programs/coe/lib/jquery/dist/jquery.min.js"></script>
  <script src="/programs/coe/lib/popper/popper.min.js"></script>
  <script src="/programs/coe/lib/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="/programs/coe/js/site.js?v=-yhGyS7FUC3Ob4cUYq4O-VCvhX5hBdGQvUwbyvy9OF0"></script>
  <script type="text/javascript">
        document.querySelectorAll("[data-alert-dismiss]").forEach(function (element) {
            element.addEventListener("click", function (e) {
                e.target.closest(".alert").style.display = "none";
            });
        });

        $(document).ready(function () {
            $("[data-ev]").click(function (e) {
                let name = e.currentTarget.getAttribute('data-ev-n');
                let category = e.currentTarget.getAttribute('data-ev-c') || 'general';
                let label = e.currentTarget.getAttribute('data-ev-l');
                try {
                    if(label === '_inner_')
                        label = e.currentTarget.textContent;
                } 
                catch (err) {
                    console.error('Cannot read text content of node');
                }

                //console.log('label: ', label)
                try {
                    gtag('event', name, {
                      'event_category': category, //  'engagement', 'social-media'
                      'event_label': label
                    });
                }
                catch(err) {
                    console.error('GA error: ', err);
                }
            });
        });
    </script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="/programs/coe/js/clipboard.min.js"></script>
  <script src="/programs/coe/js/dom-to-image.min.js"></script>
  <script src="/programs/coe/js/html2canvas.1.0.0.js"></script>
  <script src="/programs/coe/js/download.4.2.js"></script>
  <script>

        /*
        jQuery('a[href*="#"]').click(function (e) {
            setTimeout(function () {
                window.scrollBy(0, -15);
            }, 200);

        });
        */

        jQuery('a[data-footnote="scroll"]').click(function (e) {
            setTimeout(function () { window.scrollBy(0, -80); }, 50);
        });

        let scrollOffset = 70;//70;
        let selectedTaxonomyId = 0;

        jQuery(function ($) {

            var origin;
            $(".share-options li").hover(function () {
                var img = $(this).find("img");
                origin = $(img).attr("src");
                $(img).attr("src", $(img).attr("data-image-hover"));
            },
                function () {
                    var img = $(this).find("img");
                    $(img).attr("src", origin);
                });

            $(".share-button-wrap").click(function () {
                $(this).toggleClass("show");
                $(this).parent().find(".share-options").toggle();
            });


            //// if user dismissed interactive message, don't show it again
            //let cookieValue = null;
            //const cookie = document.cookie
            //    .split('; ')
            //    .find(row => row.startsWith('interactiveDismissed='));
            //if(cookie)
            //    cookieValue = cookie.split('=')[1];

            //if(cookieValue !== '1') {
            // show interactive message for first image
            $('.interact-wrapper').first().removeClass('d-none');
            setTimeout(function () {
                $('.interact-wrapper').first().addClass('d-none');
                //setChartInteractiveCookie();
            }, 45000);

            // hide interactive message when scrolling
            //let interactiveRemoved = false;
            //document.addEventListener('scroll', function(e) {
            //  if(window.scrollY > 1500 && !interactiveRemoved) {
            //      const firstFigure = $('.interact-wrapper').first();
            //      if(!firstFigure.hasClass('d-none')) {
            //          $('.interact-wrapper').first().addClass('d-none');
            //          interactiveRemoved = true;
            //      }
            //     // setChartInteractiveCookie();
            //  }
            //});
            //}



            // navigate to dropdown with taxonomy list
            $('.select-another-subgroup-link').on('click', function (ev) {
                ev.preventDefault();
                $([document.documentElement, document.body]).animate({
                    scrollTop: $('#select-another-taxonomy').offset().top - scrollOffset
                }, 200);
            });

            $('.next-finding-link').on('click', function (ev) {
                ev.preventDefault();
                // curently clicked component id
                var componentId = ev.target.getAttribute('data-component-id');
                var spans = $('span[data-taxonomy-id="' + selectedTaxonomyId + '"]');
                var nextComponentId = null;
                var nextFigureId = null;
                var showFigure = null;
                for (var spanIndex = 0; spanIndex < spans.length; spanIndex++) {
                    var tmpComponentId = spans[spanIndex].getAttribute('data-component-id');
                    if (+componentId == +tmpComponentId && spanIndex < spans.length - 1) {
                        nextComponentId = spans[spanIndex + 1].getAttribute('data-component-id');
                        nextFigureId = spans[spanIndex + 1].getAttribute('data-figure-id');
                        showFigure = spans[spanIndex + 1].getAttribute('data-show-figure');
                        break;
                    }
                }
                var elementIdToScroll = nextFigureId && showFigure == "true" ? 'figure-' + nextFigureId : 'component-' + nextComponentId;
                $([document.documentElement, document.body]).animate({
                    scrollTop: $('#' + elementIdToScroll).offset().top - scrollOffset
                }, 200);
            });
            $('.prev-finding-link').on('click', function (ev) {
                ev.preventDefault();
                // curently clicked component id
                var componentId = ev.target.getAttribute('data-component-id');
                var spans = $('span[data-taxonomy-id="' + selectedTaxonomyId + '"]');
                var prevComponentId = null;
                var prevFigureId = null;
                var showFigure = null;
                for (var spanIndex = 0; spanIndex < spans.length; spanIndex++) {
                    var tmpComponentId = spans[spanIndex].getAttribute('data-component-id');
                    if (+componentId == +tmpComponentId && spanIndex > 0) {
                        prevComponentId = spans[spanIndex - 1].getAttribute('data-component-id');
                        prevFigureId = spans[spanIndex - 1].getAttribute('data-figure-id');
                        showFigure = spans[spanIndex - 1].getAttribute('data-show-figure');
                        break;
                    }
                }
                var elementIdToScroll = prevFigureId && showFigure == "true" ? 'figure-' + prevFigureId : 'component-' + prevComponentId;
                $([document.documentElement, document.body]).animate({
                    scrollTop: $('#' + elementIdToScroll).offset().top - scrollOffset
                }, 200);
            });
        });

        function setChartInteractiveCookie() {
            // set cookie when user dismisses interactive message
            let expires = new Date();
            const year = expires.getFullYear();
            const month = expires.getMonth();
            const day = expires.getDate();
            expires = new Date(year + 1, month, day);
            document.cookie = 'interactiveDismissed=1; expires=' + expires.toString() + '; path=/';
        }

        function shareLinkClicked() {
            $('.clipboard-confirmation').show();
            setTimeout(function () {
                $('.clipboard-confirmation').hide();
            }, 2500);
        }

        function downloadFigure_static(figureId, figureNumber) {
            var figureContainer = $('#download-container-figure-' + figureId);
            var isIE = false || !!document.documentMode;
            if (isIE) {
                html2canvas(figure)
                    .then(function (canvas) {
                        //console.log(canvas)
                        //document.body.appendChild(canvas)
                        var imageData = canvas.toDataURL("image/png", 1)
                        download(imageData, "CUC-figure-" + figureNumber, "image/png")
                    })
            } else {
                domtoimage.toPng(figureContainer[0])
                    .then(function (dataUrl) {
                        figureNumber = figureNumber.replace('.', '-');
                        download(dataUrl, "CUC-figure-" + figureNumber, "image/png")
                    }).catch(function (error) {
                        console.log(error)
                    })
            }
        }


        function downloadFigure(figureId, figureNumber) {
            //console.log('figureId=', figureId, ' figureNumber=', figureNumber)
            const chartContainer = $('#download-container-figure-' + figureId);
            // hide interactive prompt
            chartContainer.find('.interact-wrapper').addClass('d-none');
            // hide all checkboxes
            chartContainer.find('label.blue-cb').addClass('downloading');

            var figureContainer = $('#download-container-figure-' + figureId);
            var isIE = false || !!document.documentMode;
            $('#download-container-figure-' + figureId).find('.tools').css('display', 'none');

            // Close "Modify figure" container if it is opened
            const optionsContainer = $('#download-container-figure-' + figureId).find('.options-container');
            let wasOpened = optionsContainer.hasClass('active');
            if (wasOpened) {
                $('#download-container-figure-' + figureId).find('.options-container').find('.options-container-footer').find('a')[0].click();
            }

            // restore UI after image is downloaded
            const restoreUI = (chartContainer, figureId) => {
                $('#download-container-figure-' + figureId).find('.tools').css('display', 'flex');
                if (wasOpened) {
                    $('#download-container-figure-' + figureId).find('.modify')[0].click();
                }
                chartContainer.find('label.blue-cb').removeClass('downloading');
            }
            const useHtml2Canvas = node => {
                html2canvas(node)
                    .then(function (canvas) {
                        var imageData = canvas.toDataURL("image/png", 1)
                        download(imageData, "CUC-figure-" + figureNumber, "image/png");
                        restoreUI(chartContainer, figureId);
                    })
                    .catch(function (error) { restoreUI(chartContainer, figureId); });
            }

            if (isIE) {
                useHtml2Canvas(figureContainer[0]);
            } else {
                try {
                    useHtml2Canvas(figureContainer[0]);
                }
                catch (error) {
                    domtoimage.toPng(figureContainer[0])
                        .then(function (dataUrl) {
                            figureNumber = figureNumber.replace('.', '-');
                            download(dataUrl, "CUC-figure-" + figureNumber, "image/png");
                            restoreUI(chartContainer, figureId);
                        }).catch(function (error) {
                            console.error(error);
                        });
                }
                //domtoimage.toPng(figureContainer[0])
                //    .then(function (dataUrl) {
                //        figureNumber = figureNumber.replace('.', '-');
                //        download(dataUrl, "CUC-figure-" + figureNumber, "image/png");
                //        restoreUI(chartContainer, figureId);
                //    }).catch(function (error) {
                //        console.error(error);
                //        // if domtoimage failed, use html2canvas
                //        useHtml2Canvas(figureContainer[0]);
                //    });
            }
        }

        // show components that belong to default selected taxonomy item
        $(document).ready(function () {
            showAllComponents();
        });

        function selectTaxonomyItem(ev, taxonomyItemId, taxonomyItemTitle) {
            selectedTaxonomyId = taxonomyItemId;
            ev.preventDefault();
            //$('#btn-show-all-findings').removeClass('button--disabled');
            $('.component-paragraph').removeClass('highlight');
            $('.chart').removeClass('highlight');
            $('#back-to-top').remove();


            if (taxonomyItemId == -1) {
                $('#all-available-findings').addClass('d-none');
                $('#select-taxonomy-item-title').text('All available findings');
                $('.select-another-subgroup-link').addClass('d-none');
                $('.next-finding-link').addClass('d-none');
                $('.prev-finding-link').addClass('d-none');
                return;
            }

            $('#all-available-findings').removeClass('d-none');

            //$('.chart').hide();
            $('#select-taxonomy-item-title').text(taxonomyItemTitle);

            var spans = $('span[data-taxonomy-id="' + taxonomyItemId + '"]');
            // hide all navigation links
            $('.select-another-subgroup-link').addClass('d-none');
            $('.next-finding-link').addClass('d-none');
            $('.prev-finding-link').addClass('d-none');

            var elementIdToScroll = null;
            for (var spanIndex = 0; spanIndex < spans.length; spanIndex++) {
                var componentId = spans[spanIndex].getAttribute('data-component-id');
                var figureNumber = spans[spanIndex].getAttribute('data-figure-number');
                var figureId = spans[spanIndex].getAttribute('data-figure-id');
                var showFigure = spans[spanIndex].getAttribute('data-show-figure');

                // highlight paragraphs and figures
                $('#component-' + componentId).addClass('highlight');
                if (figureId)
                    $('#figure-' + figureId).addClass('highlight');

                // get first element that we need to scroll to
                if (spanIndex == 0)
                    elementIdToScroll = figureId ? 'figure-' + figureId : 'component-' + componentId

                // hide/show navigation links
                if (spanIndex == spans.length - 1)
                    $('#component-' + componentId).find('.select-another-subgroup-link').removeClass('d-none');
                if (spanIndex > 0)
                    $('#component-' + componentId).find('.prev-finding-link').removeClass('d-none');
                if (spanIndex < spans.length - 1)
                    $('#component-' + componentId).find('.next-finding-link').removeClass('d-none');
            }

            // scroll to first element
            $([document.documentElement, document.body]).animate({
                scrollTop: $('#' + elementIdToScroll).offset().top - scrollOffset
            }, 200);


            // now add "Back to top" link
            //var lastHighlightedParagraph = $('.component-paragraph.highlight').last();
            //lastHighlightedParagraph.after("<div id='back-to-top' class='text-right mt-2 mb-4'><a href='#tag-dropdown'>Back to Top <img src='" + '/programs/coe/images/back-to-top.svg' + "' /></a></div>");
        }

        function showAllComponents(ev) {
            $('.component-paragraph').show();
            $('.chart').show();
            $('#select-taxonomy-item-title').text('All available findings');
            //$('#btn-show-all-findings').addClass('button--disabled');
        }
    </script><!-- FOOTER STARTS HERE--> <!-- opening footer div -->
  <div>
  </div>
  <div class="footer_container nces">
   <div class="footer">
    <div class="clearfix footer_top">
     <div class="bc clearfix">
      <div class="logo_container">
       <a href="//ies.ed.gov/" class="ies_nav">IES</a> <span class="carrot">&nbsp;<img src="/images/icons/iesNewDots.png" alt=" ">&nbsp;</span> <a href="/" class="nces_nav">
        <div class="l">
         NCES
        </div><span class="long_name">National Center for<br>
          Education Statistics</span> </a>
      </div>
     </div>
     <div class="social">
      <div class="social-link">
       <div class="tooltip">
        Join Newsflash
       </div><a href="//ies.ed.gov/newsflash/#nces" target="_blank"><img src="/images/hfs/newspaper.svg" data-src="/images/hfs/newspaper.svg" data-over-src="/images/hfs/newspaper-nces.svg" alt="Join Newsflash" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
      <div class="social-link">
       <div class="tooltip">
        NCES Blog
       </div><a href="/blogs/nces/" target="_blank"><img src="/images/hfs/pen-square.svg" data-src="/images/hfs/pen-square.svg" data-over-src="/images/hfs/pen-square-nces.svg" alt="NCES Blog" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
      <div class="social-link">
       <div class="tooltip">
        EdNCES Twitter
       </div><a href="//twitter.com/EdNCES" target="_blank"><img src="/images/hfs/twitter.svg" data-src="/images/hfs/twitter.svg" data-over-src="/images/hfs/twitter-nces.svg" alt="EdNCES Twitter" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
      <div class="social-link">
       <div class="tooltip">
        EdNCES Facebook
       </div><a href="//www.facebook.com/EdNCES/" target="_blank"><img src="/images/hfs/facebook-square.svg" data-src="/images/hfs/facebook-square.svg" data-over-src="/images/hfs/facebook-square-nces.svg" alt="EdNCES Facebook" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
      <div class="social-link">
       <div class="tooltip">
        EdNCES LinkedIn
       </div><a href="//www.linkedin.com/company/ednces/" target="_blank"><img src="/images/hfs/linkedin.svg" data-src="/images/hfs/linkedin.svg" data-over-src="/images/hfs/linkedin-nces.svg" alt="EdNCES LinkedIn" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
      <div class="social-link">
       <div class="tooltip">
        EdNCES YouTube
       </div><a href="//www.youtube.com/c/EdNCES/featured" target="_blank"><img src="/images/hfs/youtube.svg" data-src="/images/hfs/youtube.svg" data-over-src="/images/hfs/youtube-nces.svg" alt="EdNCES YouTube" onmouseover="ies_social(event)" onmouseout="ies_social(event)"></a>
      </div>
     </div>
    </div>
    <div class="clearfix footer_nav">
     <div class="clearfix left_s">
      <span class="section">Explore the Institute of Education Sciences</span>
      <div class="left_s">
       <ul>
        <li><a href="//ies.ed.gov/" class="center_title">IES</a></li>
        <li><a href="//ies.ed.gov/">Home</a></li>
        <li><a href="//ies.ed.gov/aboutus/">About</a></li>
        <li><a href="//ies.ed.gov/pubsearch/">Publications</a></li>
        <li><a href="//ies.ed.gov/data.asp">Data</a></li>
        <li><a href="//ies.ed.gov/funding/">Funding</a></li>
        <li><a href="//ies.ed.gov/events.asp">News</a></li>
       </ul>
      </div>
      <div class="right_s">
       <ul>
        <li><span class="center_title">IES Centers</span></li>
        <li><a href="//ies.ed.gov/ncee/">NCEE</a></li>
        <li><a href="//ies.ed.gov/ncer/">NCER</a></li>
        <li><a href="/">NCES</a>
         <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="/surveys/">Programs</a></li>
          <li><a href="/pubsearch/">Publications</a></li>
          <li><a href="/datatools/">Data</a></li>
          <li><a href="/training/datauser/">Data Training</a></li>
          <li><a href="/globallocator/">School Search</a></li>
          <li><a href="/whatsnew/">News</a></li>
          <li><a href="/nceskids/">Kids' Zone</a></li>
         </ul></li>
        <li><a href="//ies.ed.gov/ncser/">NCSER</a></li>
       </ul>
      </div>
     </div>
     <div class="clearfix right_s">
      <div class="left_s">
       <ul>
        <li><span class="section">IES Policies and Standards</span></li>
        <li><a href="//datainventory.ed.gov">ED Data Inventory</a></li>
        <li><a href="//ies.ed.gov/aboutus/diversity.asp">IES Diversity Statement</a></li>
        <li><a href="/statprog/2012/">NCES Statistical Standards</a></li>
        <li><a href="//ies.ed.gov/director/sro/">Peer Review Process</a></li>
        <li><a href="//ies.ed.gov/help/privacy.asp">Privacy and Security Policies</a></li>
        <li><a href="//ies.ed.gov/funding/researchaccess.asp">Public Access Policy</a></li>
       </ul>
       <ul>
        <li>&nbsp;</li>
        <li><a href="/help/webmail/" class="section">Contact Us</a></li>
        <li>&nbsp;</li>
        <li><a href="http://www.ed.gov/"><strong>U.S. Department of Education</strong></a></li>
       </ul>
      </div>
      <div class="right_s">
       <ul>
        <li><span class="section">Additional Resources</span></li>
        <li><a href="//eric.ed.gov/">ERIC</a></li>
        <li><a href="/help/sitemap.asp">Sitemap</a></li>
        <li><a href="/about/?sec=orgchart">Organizational Chart</a></li>
       </ul>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script id="_fed_an_ua_tag" language="javascript" type="text/javascript" src="/js/Universal-Federated-Analytics-Min.js?pua=UA-55622235-1&amp;agency=ED&amp;subagency=NCES&amp;exts=sps,sas,do,dct"></script><!-- FOOTER ENDS HERE-->
 </body>
</html>